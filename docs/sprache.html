<html><head><title>–ü–∞—Ä—Å–µ—Ä-–∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä—ã –Ω–∞ Sprache</title></head><body><link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üßë‚Äçüíª</text></svg>"><link rel="stylesheet" href="bear.css"/><div><h1 class='page_title' style='margin-top: 0.5em;'>üß± –ü–∞—Ä—Å–µ—Ä-–∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä—ã –Ω–∞ Sprache</h1><p>–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏–Ω–æ–≥–¥–∞ —Å—Ç–∞–ª–∫–∏–≤–∞—é—Ç—Å—è —Å –∑–∞–¥–∞—á–µ–π —Ä–∞–∑–æ–±—Ä–∞—Ç—å —Ç–µ–∫—Å—Ç (—Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å) –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ –∏ –∏–∑–≤–ª–µ—á—å –∏–∑ –Ω–µ–≥–æ –ø–æ–ª–µ–∑–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é. –ü—Ä–∏–º–µ—Ä—ã —Ç–æ–≥–æ, —á—Ç–æ –º–æ–∂–Ω–æ –ø–∞—Ä—Å–∏—Ç—å ‚Äî JSON, –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –Ω–∞ –ª—é–±–æ–º —è–∑—ã–∫–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è.</p><p>–ü–∞—Ä—Å–∏–Ω–≥ (–æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤) ‚Äî <a href="https://blog.newrelic.com/engineering/7-things-never-code/">–Ω–µ —Ç–∞ –∑–∞–¥–∞—á–∞, –∫–æ—Ç–æ—Ä—É—é –Ω—É–∂–Ω–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞—Ç—å —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ</a>. –ü–æ—ç—Ç–æ–º—É –∫–∞–∂–¥—ã–π –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç –¥–æ–ª–∂–µ–Ω –Ω–∞–ø–∏—Å–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–∞—Ä—Å–µ—Ä–æ–≤ ‚Äî —á—Ç–æ–±—ã –ø–æ–≤–µ—Å–µ–ª–∏—Ç—å—Å—è –∏ –Ω–∏–∫–æ–≥–¥–∞ —Ç–∞–∫ –±–æ–ª—å—à–µ –Ω–µ –¥–µ–ª–∞—Ç—å, –∫–æ–Ω–µ—á–Ω–æ –∂–µ.</p><p>–í —ç—Ç–æ–π —Å—Ç–∞—Ç—å–µ —Ä–∞—Å—Å–∫–∞–∂—É, –∫–∞–∫ –º–æ–∂–Ω–æ –ª–µ–≥–∫–æ –Ω–∞–ø–∏—Å–∞—Ç—å —Å–≤–æ–π –ø–∞—Ä—Å–µ—Ä —Å –ø–æ–º–æ—â—å—é –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ <a href="https://github.com/sprache/Sprache">Sprache</a>.</p><h2>–ù–∞–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥</h2><p>–í –æ–¥–Ω–æ–º –∏–∑ –¥–æ–º–∞—à–Ω–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ –º–Ω–µ –ø–æ—Ç—Ä–µ–±–æ–≤–∞–ª–æ—Å—å –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –∞—Ä—Ö–∏–≤ —Ç–µ–∫—Å—Ç–æ–≤, —Å–æ–¥–µ—Ä–∂–∞—â–∏—Ö –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ —Å–ª–æ–≤–∞. –§–∏–ª—å—Ç—Ä—ã –æ–∫–∞–∑–∞–ª–æ—Å—å —É–¥–æ–±–Ω–æ –∑–∞–¥–∞–≤–∞—Ç—å –≤ –≤–∏–¥–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–π, –ø–æ—Ö–æ–∂–∏—Ö –Ω–∞ <a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/combining-filters.html">Must/Should</a> –∏–∑ Elastic Search. –§–∏–ª—å—Ç—Ä <code>Must</code> —Ç—Ä–µ–±—É–µ—Ç, —á—Ç–æ–±—ã –≤—Å–µ —Å–ª–æ–≤–∞ –≤—Å—Ç—Ä–µ—Ç–∏–ª–∏—Å—å –≤ —Ç–µ–∫—Å—Ç–µ, <code>Should</code> ‚Äî —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ. –ò–∑ –ø—Ä–æ—Å—Ç—ã—Ö —É—Å–ª–æ–≤–∏–π —Å –ø–æ–º–æ—â—å—é <code>Must</code> –∏ <code>Should</code> –º–æ–∂–Ω–æ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ.</p><p>–£—Å–ª–æ–≤–∏—è –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞ –∑–∞–¥–∞—é—Ç—Å—è —Ç–µ–∫—Å—Ç–æ–º –≤ —Ç–∞–∫–æ–º –≤–∏–¥–µ:</p><pre><code>(
    [–ì—Ä–µ—Ü–∏—è, –°–∞–ª–æ–Ω–∏–∫–∏, –†–æ–¥–æ—Å],
    [–õ–∏—Å—Å–∞–±–æ–Ω, –ü–æ—Ä—Ç—É, –ü–æ—Ä—Ç—É–≥–∞–ª–∏—è],
    –î—É–±–ª–∏–Ω
)</code></pre><p>–°–ª–æ–≤–∞ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Ä–∞–∑–¥–µ–ª—è—é—Ç—Å—è –∑–∞–ø—è—Ç—ã–º–∏. –£—Å–ª–æ–≤–∏–µ <code>Must</code> –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ –∫—Ä—É–≥–ª—ã–µ —Å–∫–æ–±–∫–∏, <code>Should</code> ‚Äî –≤ –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ.</p><p>–§–∏–ª—å—Ç—Ä –º–æ–∂–Ω–æ –æ–ø–∏—Å–∞—Ç—å –ø—Ä–æ—Å—Ç–æ–π –≥—Ä–∞–º–º–∞—Ç–∏–∫–æ–π (–≤ <a href="https://en.wikipedia.org/wiki/Backus%E2%80%93Naur_form">—Ñ–æ—Ä–º–µ –ë—ç–∫—É—Å–∞ ‚Äî –ù–∞—É—Ä–∞</a>):</p><pre><code>&lt;word&gt; := &lt;letter&gt; | &lt;letter&gt;&lt;word&gt;
&lt;list&gt; := &lt;word&gt; | &lt;word&gt; &quot;,&quot; &lt;list&gt;
&lt;should&gt; := &quot;[&quot; &lt;list&gt; &quot;]&quot;
&lt;must&gt; := &quot;(&quot; &lt;list&gt; &quot;)&quot;
&lt;expr&gt; := &lt;word&gt; | &lt;must&gt; | &lt;should&gt;</code></pre><p>–ü—Ä–æ—â–µ –ø—Ä–æ—Å—Ç–æ–≥–æ! –î–∞–≤–∞–π—Ç–µ –Ω–∞–ø–∏—à–µ–º –Ω–∞–∏–≤–Ω—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –ø–∞—Ä—Å–µ—Ä–∞. –î–ª—è —ç—Ç–æ–≥–æ –≤–æ—Å–ø–æ–ª—å–∑—É–µ–º—Å—è –¥–µ–¥–æ–≤—Å–∫–∏–º –ø–æ–¥—Ö–æ–¥–æ–º, –∫–æ—Ç–æ—Ä—ã–π –≤—ã—Ä—É—á–∞–ª –µ—â–µ –Ω–∞ –ø–∞—Ä–∞—Ö –ø–æ –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º –≤ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–µ:</p><ul><li>–ó–∞–ø–æ–º–Ω–∏–º —Ç–µ–∫—É—â–µ–µ —Å–ª–æ–≤–æ. –ë—É–¥–µ–º –¥–æ–ø–∏—Å—ã–≤–∞—Ç—å –∫ –Ω–µ–º—É –Ω–æ–≤—ã–π —Å–∏–º–≤–æ–ª, –µ—Å–ª–∏ –≤—Å—Ç—Ä–µ—Ç–∏–º –µ–≥–æ (–∏ —Å–∏–º–≤–æ–ª –Ω–µ –±—É–¥–µ—Ç —Å–∫–æ–±–∫–æ–π –∏–ª–∏ –∑–∞–ø—è—Ç–æ–π);</li><li>–ó–∞–≤–µ–¥–µ–º —Å—Ç–µ–∫ –¥–ª—è –∑–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Å–∫–æ–±–æ–∫;</li><li>–í–º–µ—Å—Ç–µ —Å –æ—Ç–∫—Ä—ã—Ç–æ–π —Å–∫–æ–±–∫–æ–π –±—É–¥–µ–º —Ö—Ä–∞–Ω–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∏–∑ –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ –≤–Ω—É—Ç—Ä–∏ —ç—Ç–æ–π —Å–∫–æ–±–∫–∏.</li></ul><p>–ü–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –ø–∞—Ä—Å–µ—Ä–∞ –Ω–∞ <a href="https://github.com/BurlakovNick/sprache-examples/blob/master/Parsers/ParserExamples/Example1/NaiveFilterParser.cs">github</a>.</p><p>–ú–µ—Ä–ª–∏–Ω–æ–≤–∞ –±–æ—Ä–æ–¥–∞! –ü–æ–ª—É—á–∏–ª–æ—Å—å –Ω–µ —Ç–∞–∫-—Ç–æ –ø—Ä–æ—Å—Ç–æ. –ü–æ—á—Ç–∏ —Å—Ç–æ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞, –º–Ω–æ–∂–µ—Å—Ç–≤–æ —É—Å–ª–æ–≤–∏–π, –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è —Ä–∞–±–æ—Ç–∞ —Å–æ —Å—Ç–µ–∫–æ–º ‚Äî —É–∂–∞—Å!</p><p>–í –Ω–∞–∏–≤–Ω–æ–º –ø–æ–¥—Ö–æ–¥–µ —è –≤–∏–∂—É –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ–±–ª–µ–º:</p><ul><li>–ö–æ–¥ –ø–∞—Ä—Å–µ—Ä–∞ –ª–∞–ø—à–µ–æ–±—Ä–∞–∑–Ω—ã–π, –≤ –Ω–µ–≥–æ —Å—Ç—Ä–∞—à–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ñ–∏—á–∏;</li><li>–ï—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫—Ä–∞–π–Ω–∏—Ö —Å–ª—É—á–∞–µ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ª–µ–≥–∫–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å (–º–æ–¥—É–ª—å–Ω—ã–º–∏ —Ç–µ—Å—Ç–∞–º–∏ —è –æ—Ç–ª–æ–≤–∏–ª 3 –±–∞–≥–∞ –ø–µ—Ä–µ–¥ —Ç–µ–º, –∫–∞–∫ —ç—Ç–æ—Ç –∫–æ–¥ –∑–∞—Ä–∞–±–æ—Ç–∞–ª);</li><li>–ò –∫–æ–¥ —Å–æ–≤–µ—Ä—à–µ–Ω–Ω–æ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –≥—Ä–∞–º–º–∞—Ç–∏–∫—É, –∫–æ—Ç–æ—Ä—É—é –º—ã —Ä–∞–∑–±–∏—Ä–∞–µ–º.</li></ul><p>–ù–æ –≤–µ–¥—å –≥—Ä–∞–º–º–∞—Ç–∏–∫–∞ —è–∑—ã–∫–∞ –ø—Ä–æ—Å—Ç–∞—è! –ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ç–∞–∫ —Å–ª–æ–∂–Ω–æ. –•–æ—á–µ—Ç—Å—è –ø–æ–ª—É—á–∏—Ç—å –ø–∞—Ä—Å–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –ø—Ä–æ—Å—Ç–æ —Å–∫–æ—Ä–º–∏–≤ –º–∞—à–∏–Ω–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≥—Ä–∞–º–º–∞—Ç–∏–∫–∏. –ú–æ–∂–Ω–æ –ª–∏ —Ç–∞–∫ —Å–¥–µ–ª–∞—Ç—å? –û–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è, –º–æ–∂–Ω–æ!</p><h2>–ú–æ–Ω–∞–¥–∏—á–µ—Å–∫–∏–µ –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä—ã –ø–∞—Ä—Å–µ—Ä–æ–≤</h2><p>–û–¥–∏–Ω –∏–∑ –ø–æ–¥—Ö–æ–¥–æ–≤ –∫ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—é –ø–∞—Ä—Å–µ—Ä–æ–≤ ‚Äî –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å –ø—Ä–æ—Å—Ç—ã–µ –ø–∞—Ä—Å–µ—Ä—Å—ã –≤ –≤–∏–¥–µ —Ñ—É–Ω–∫—Ü–∏–π, –∞ –∑–∞—Ç–µ–º –Ω–∞—É—á–∏—Ç—å—Å—è –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å –∏—Ö —Å –ø–æ–º–æ—â—å—é —Ñ—É–Ω–∫—Ü–∏–π –≤—ã—Å—à–µ–≥–æ –ø–æ—Ä—è–¥–∫–∞ (–∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä–æ–≤).</p><p>–ü–æ–ø—ã—Ç–∞—é—Å—å –¥–æ—Å—Ç—É–ø–Ω–æ –∏–∑–ª–æ–∂–∏—Ç—å –∏–¥–µ—é. –ó–∞ —Ö–∞—Ä–¥–∫–æ—Ä–æ–º –æ—Ç—Å—ã–ª–∞—é –∫ —Å—Ç–∞—Ç—å–µ ‚Äî <a href="http://www.cs.nott.ac.uk/~pszgmh/monparsing.pdf">Hutton, Meijer, Monadic parser combinators</a>.</p><p>–ü–∞—Ä—Å–µ—Ä ‚Äî —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å—Ç—Ä–æ–∫—É, –ø—ã—Ç–∞–µ—Ç—Å—è —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –∫–∞–∫–æ–µ-—Ç–æ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –∏ –≥–æ–≤–æ—Ä–∏—Ç, –∫–∞–∫—É—é —á–∞—Å—Ç—å –≤—Ö–æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ –æ—Å—Ç–∞–ª–æ—Å—å —Ä–∞–∑–æ–±—Ä–∞—Ç—å:</p><pre><code>public delegate IResult&lt;T&gt; Parser&lt;out T&gt;(IInput input);

public interface IResult&lt;T&gt;
{
    bool Success { get; }
    IInput Remainder { get; }
    T ParsedValue { get; }
}

public interface IInput
{
    char Current { get; }
    IInput Advance();
}</code></pre><p><code>IInput</code> ‚Äî –∏—Ç–µ—Ä–∞—Ç–æ—Ä –ø–æ –≤—Ö–æ–¥–Ω—ã–º –¥–∞–Ω–Ω—ã–º –ø–∞—Ä—Å–µ—Ä–∞, –ø–æ–º–æ–≥–∞–µ—Ç –ø–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Å–∏–º–≤–æ–ª (<code>Current</code>) –∏ –¥–≤–∏–Ω—É—Ç—å—Å—è –¥–∞–ª—å—à–µ (<code>Advance</code>).</p><p>–ü—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä –ø–∞—Ä—Å–µ—Ä–∞ ‚Äî –ø–∞—Ä—Å–µ—Ä –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Å–∏–º–≤–æ–ª–∞:</p><pre><code>public static Parser&lt;string&gt; Char(char ch)
{
    return (Parser&lt;string&gt;)(input =&gt; {
        if (input.Current == ch)
            return Result.Success&lt;string&gt;(
                input.Current.ToString(),
                input.Advance());
        else
            return Result.Failure&lt;string&gt;(input);
    });
}</code></pre><p>–ü–∞—Ä—Å–µ—Ä –¥–ª—è –æ–¥–∏–Ω–æ—á–Ω–æ–≥–æ —Å–∏–º–≤–æ–ª–∞ –ø—Ä–æ—Å—Ç ‚Äî –º—ã –ª–∏–±–æ –≤—Å—Ç—Ä–µ—Ç–∏–ª–∏ –Ω—É–∂–Ω—ã–π —Å–∏–º–≤–æ–ª (–∏ —Ç–æ–≥–¥–∞ –¥–≤–∏–≥–∞–µ–º –∏—Ç–µ—Ä–∞—Ç–æ—Ä <code>input</code> –¥–∞–ª—å—à–µ), –ª–∏–±–æ —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å —Å–∏–º–≤–æ–ª –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å. –ü–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≥–æ—Ç–æ–≤—ã–º –ø–∞—Ä—Å–µ—Ä–æ–º —Ç–∞–∫ –∂–µ –ª–µ–≥–∫–æ, –∫–∞–∫ –∏ –ª—é–±—ã–º –¥–µ–ª–µ–≥–∞—Ç–æ–º ‚Äî –Ω—É–∂–Ω–æ –ª–∏—à—å –≤—ã–∑–≤–∞—Ç—å –≥–æ—Ç–æ–≤—ã–π –ø–∞—Ä—Å–µ—Ä –∏ –ø–µ—Ä–µ–¥–∞—Ç—å –µ–º—É –Ω–∞ –≤—Ö–æ–¥ –∫–∞–∫–æ–π-—Ç–æ —Ç–µ–∫—Å—Ç, –Ω–∞–ø—Ä–∏–º–µ—Ä:</p><pre><code>var result = Char(&#x27;a&#x27;)(&quot;abacaba&quot;);

//–†–µ–∑—É–ª—å—Ç–∞—Ç - &#x27;a&#x27;
Console.WriteLine(result.Value);
//–†–µ–∑—É–ª—å—Ç–∞—Ç - &quot;bacaba&quot;
Console.WriteLine(result.Remainder);</code></pre><p>–ò–∑ –ø—Ä–æ—Å—Ç—ã—Ö –ø–∞—Ä—Å–µ—Ä–æ–≤ –º–æ–∂–Ω–æ —Å–æ–±–∏—Ä–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ —Å –ø–æ–º–æ—â—å—é –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä–æ–≤ ‚Äî —Ñ—É–Ω–∫—Ü–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏–Ω–∏–º–∞—é—Ç –Ω–∞ –≤—Ö–æ–¥ –¥—Ä—É–≥–∏–µ –ø–∞—Ä—Å–µ—Ä—ã –∏ —Å–æ–∑–¥–∞—é—Ç –∏–∑ –Ω–∏—Ö –Ω–µ—á—Ç–æ –±–æ–ª—å—à–µ–µ.</p><p>–°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä ‚Äî <code>Or</code>. –ù–∞–ø—Ä–∏–º–µ—Ä, —Ä–∞—Å–ø–∞—Ä—Å–∏–º –±—É–∫–≤—É <code>a</code> –∏–ª–∏ –±—É–∫–≤—É¬†<code>b</code>:</p><pre><code>public static Parser&lt;T&gt; Or&lt;T&gt;(
    this Parser&lt;T&gt; left,
    Parser&lt;T&gt; right)
{
    return (Parser&lt;string&gt;)(input =&gt; {
        var result = left(input);
        return result.Success
            ? result
            : right(input);
    });
}

var parser = Char(&#x27;a&#x27;).Or(Char(&#x27;b&#x27;));</code></pre><p>–° –ø–æ–º–æ—â—å—é –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä–∞ <code>Many</code> –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø–∞—Ä—Å–µ—Ä –¥–ª—è —Å–ª–æ–≤–∞, —Å–æ—Å—Ç–æ—è—â–µ–≥–æ –∏–∑ –æ–¥–Ω–∏—Ö –ª–∏—à—å –±—É–∫–≤:</p><pre><code>public static Parser&lt;string&gt; Letter()
{
    return (Parser&lt;string&gt;)(input =&gt; {
        if (char.IsLetter(input.Current))
            return Result.Success&lt;string&gt;(
                input.Current.ToString(),
                input.Advance());
        else
            return Result.Failure&lt;string&gt;(
                input);
    });
}

public static Parser&lt;IEnumerable&lt;T&gt;&gt; Many&lt;T&gt;(this Parser&lt;T&gt; parser)
{
    return Parser&lt;IEnumerable&lt;T&gt;&gt;(input =&gt; {
        var list = new List&lt;T&gt;();
        for (var result = parser(input);
            result.Success;
            result = parser(input))
        {
            list.Add(result.Value);
            input = result.Remainder;
        }
        return Result.Success&lt;IEnumerable&lt;T&gt;&gt;(
            (IEnumerable&lt;T&gt;) list, input);
    });
}

var parser = Letter().Many();
var result = parser(&quot;abc123&quot;);

//–†–µ–∑—É–ª—å—Ç–∞—Ç - &quot;abc&quot;
Console.WriteLine(result.Value);
//–†–µ–∑—É–ª—å—Ç–∞—Ç - &quot;123&quot;
Console.WriteLine(result.Remainder);</code></pre><p>–ò–ª–∏ –º–æ–∂–Ω–æ —Å–∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä—Å–µ—Ä—ã –¥–≤—É—Ö —Å—Ç—Ä–æ–∫, –∏–¥—É—â–∏—Ö –¥—Ä—É–≥ –∑–∞ –¥—Ä—É–≥–æ–º, —Å –ø–æ–º–æ—â—å—é –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä–∞ <code>Then</code>:</p><pre><code>public static Parser&lt;string&gt; Then(
    this Parser&lt;string&gt; left,
    Func&lt;string, Parser&lt;string&gt;&gt; right)
{
    return (Parser&lt;string&gt;)(input =&gt; {
        var result = left(input);
        if (!result.Success)
        {
            return result;
        }
        return right(result.Value)(result.Remainder);
    });
}</code></pre><p>–ó–¥–µ—Å—å –≤–º–µ—Å—Ç–æ –ø–∞—Ä—Å–µ—Ä–∞ —Å–ø—Ä–∞–≤–∞ –≤ <code>Then</code> –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –¥–µ–ª–µ–≥–∞—Ç <code>Func&lt;string, Parser&lt;string&gt;&gt;</code>, –∞—Ä–≥—É–º–µ–Ω—Ç –∫–æ—Ç–æ—Ä–æ–≥–æ ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –ø–∞—Ä—Å–µ—Ä–∞. –≠—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ, —á—Ç–æ–±—ã —Å–∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–≤—É—Ö –ø–∞—Ä—Å–µ—Ä–æ–≤.</p><p>–≠—Ç–∏—Ö –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä–æ–≤ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ, —á—Ç–æ–±—ã –Ω–∞–ø–∏—Å–∞—Ç—å –ø–∞—Ä—Å–µ—Ä —Å–ª–æ–≤, –∑–∞–∫–ª—é—á–µ–Ω–Ω—ã—Ö –≤ –∫—Ä—É–≥–ª—ã–µ —Å–∫–æ–±–∫–∏:</p><pre><code>var wordParser =
    Char(&#x27;(&#x27;)
    .Then(left =&gt; (left, AnyLetter().Many())
    .Then((left, word) =&gt; (left, word, Char(&#x27;)&#x27;)))
    //–ª–µ–≤–∞—è –∏ –ø—Ä–∞–≤–∞—è —Å–∫–æ–±–∫–∞ –Ω–µ –Ω—É–∂–Ω—ã, –¥–µ–ª–∞–µ–º discard –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    //—Å–ø–∞—Å–∏–±–æ —Ç–µ–±–µ, C# 7.0!
    .Then((_, word, _) =&gt; word);</code></pre><h2>–ü—Ä–∏ —á–µ–º –∑–¥–µ—Å—å –º–æ–Ω–∞–¥—ã?</h2><p>–§–∏—à–∫–∞ –≤ —Ç–æ–º, —á—Ç–æ –ø–∞—Ä—Å–µ—Ä ‚Äî —ç—Ç–æ <a href="https://mikhail.io/2016/01/monads-explained-in-csharp/">–º–æ–Ω–∞–¥–∞</a> –≤ —á–∏—Å—Ç–æ–º –≤–∏–¥–µ. –ú–æ–Ω–∞–¥–∞ ‚Äî —ç—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ–∫–æ—Ç–æ—Ä–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è. –£ –º–æ–Ω–∞–¥—ã –µ—Å—Ç—å:</p><ul><li>–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–±–∏—Ä–∞–µ—Ç –º–æ–Ω–∞–¥—É. –í —Å–ª—É—á–∞–µ –ø–∞—Ä—Å–µ—Ä–∞ ‚Äî –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞–µ—Ç –ø–∞—Ä—Å–µ—Ä –æ–¥–Ω–æ–≥–æ —Å–∏–º–≤–æ–ª–∞;</li><li>–û–ø–µ—Ä–∞—Ü–∏—è —Å–≤—è–∑—ã–≤–∞–Ω–∏—è (<code>bind</code>), –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å –º–æ–Ω–∞–¥—ã. –í —Å–ª—É—á–∞–µ –ø–∞—Ä—Å–µ—Ä–æ–≤ ‚Äî —ç—Ç–æ –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä—ã <code>Or</code>, <code>Then</code>, <code>Many</code> –∏ –¥—Ä—É–≥–∏–µ.</li></ul><p>–ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è –º–æ–Ω–∞–¥—ã —á–∞—Å—Ç–æ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –≤ –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏—è—Ö. –°–∞–º—ã–µ –∏–∑–≤–µ—Å—Ç–Ω—ã–µ –º–æ–Ω–∞–¥—ã –∏–∑ —è–∑—ã–∫–∞ C#:</p><ul><li>–ú–æ–Ω–∞–¥–∞ —Å–ø–∏—Å–∫–∞ <code>IEnumerable&lt;T&gt;</code> ‚Äî –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –Ω–∞–¥ –∫–æ–ª–ª–µ–∫—Ü–∏—è–º–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å –ø–æ–º–æ—â—å—é LINQ;</li><li>–ú–æ–Ω–∞–¥–∞ –∑–∞–¥–∞—á–∏ <code>Task&lt;T&gt;</code> ‚Äî –Ω—É–∂–Ω–∞ –¥–ª—è –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.</li></ul><h2>–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞—Ä—Å–µ—Ä–∞ —Å –ø–æ–º–æ—â—å—é Sprache</h2><p>–ü–æ–ø—Ä–æ–±—É–µ–º —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ç–æ—Ç –∂–µ –ø–∞—Ä—Å–µ—Ä —Å –ø–æ–º–æ—â—å—é <a href="https://github.com/sprache/Sprache">Sprache</a> ‚Äî –ª–µ–≥–∫–æ–≤–µ—Å–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏, –≤ –∫–æ—Ç–æ—Ä–æ–π —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Ä–∞–∑–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä—ã –ø–∞—Ä—Å–µ—Ä–æ–≤. –ò—Å—Ö–æ–¥–Ω–∏–∫–∏ —Å–º–æ—Ç—Ä–∏ –Ω–∞ <a href="https://github.com/BurlakovNick/sprache-examples/blob/master/Parsers/ParserExamples/Example1/FilterParser.cs">Github</a>.</p><p>–ù–∞ –≤—ã—Ö–æ–¥–µ –ø–∞—Ä—Å–µ—Ä –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å <code>IFilter</code> ‚Äî –∫–æ–º–±–∏–Ω–∞—Ü–∏—é —Ñ–∏–ª—å—Ç—Ä–æ–≤ <code>Must</code> –∏ <code>Should</code>, —Å–æ–±—Ä–∞–Ω–Ω—É—é –ø–æ —Å–∫–æ–±–æ—á–Ω–æ–º—É –≤—ã—Ä–∞–∂–µ–Ω–∏—é. –í—ã—Ä–∞–∂–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –ø–∞—Ä—Å–∏–º ‚Äî —ç—Ç–æ –æ–¥–Ω–æ —Å–ª–æ–≤–æ –∏–ª–∏ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ <code>Must</code> –∏–ª–∏ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ <code>Should</code>.</p><pre><code>private static Parser&lt;IFilter&gt; Expr =&gt; Should.XOr(Must).XOr(Word);</code></pre><p>–î–ª—è –Ω–∞—á–∞–ª–∞ –Ω–∞–ø–∏—à–µ–º –ø–∞—Ä—Å–µ—Ä –æ–¥–Ω–æ–≥–æ —Å–ª–æ–≤–∞:</p><pre><code>private static Parser&lt;IFilter&gt; Word =&gt;
    Parse
        .LetterOrDigit
        .AtLeastOnce()
        .Text()
        .Select(word =&gt; new WordFilter(word));</code></pre><p>–¢–µ–ø–µ—Ä—å –Ω–∞—É—á–∏–º—Å—è –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å —Å–ª–æ–≤–∞ —Å –ø–æ–º–æ—â—å—é —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–µ–π:</p><pre><code>private static Parser&lt;IEnumerable&lt;IFilter&gt;&gt; List =&gt;
    Parse.Ref(() =&gt; Expr)
        .DelimitedBy(Parse.Chars(&#x27;,&#x27;, &#x27;;&#x27;));</code></pre><p>–ú–µ—Ç–æ–¥ <code>Parse.Ref</code> –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–µ—è–≤–Ω–æ —Å–æ—Å–ª–∞—Ç—å—Å—è –Ω–∞ –¥—Ä—É–≥–æ–π –ø–∞—Ä—Å–µ—Ä, —á—Ç–æ–±—ã —Ä–∞–∑–æ—Ä–≤–∞—Ç—å —Ü–∏–∫–ª–∏—á–µ—Å–∫—É—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å (<code>Expr</code> -&gt; <code>Should</code> -&gt; <code>List</code> -&gt; <code>Expr</code>). –§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ (<code>() =&gt; Expr</code>) –±—É–¥–µ—Ç –æ—Ç–ª–æ–∂–µ–Ω–æ –¥–æ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –∫ –ø–∞—Ä—Å–µ—Ä—É.</p><p>–†–∞—Å–ø–∞—Ä—Å–∏–º –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –≤ —Å–∫–æ–±–∫–∞—Ö:</p><pre><code>private static Parser&lt;IFilter&gt; Should =&gt;
    from left in Parse.Char(&#x27;[&#x27;)
    from expr in List.Optional()
    from right in Parse.Char(&#x27;]&#x27;)
    select new ShouldFilter(expr.GetOrDefault()?.ToList());

private static Parser&lt;IFilter&gt; Must =&gt;
    from left in Parse.Char(&#x27;(&#x27;)
    from expr in List.Optional()
    from right in Parse.Char(&#x27;)&#x27;)
    select new MustFilter(expr.GetOrDefault()?.ToList());</code></pre><p>–¢–∞–∫, —á—Ç–æ –∑–∞ –µ—Ä—É–Ω–¥–∞ —Å <code>from</code> –∏ <code>in</code>? –≠—Ç–æ —Ö–∏–ø—Å—Ç–µ—Ä—Å–∫–∏–π LINQ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å ‚Äî –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–º–µ–Ω—è–µ—Ç —Ç–∞–∫–∏–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –Ω–∞ —Ü–µ–ø–æ—á–∫—É –≤—ã–∑–æ–≤–æ–≤, –ø–æ—Ç–æ–º—É —á—Ç–æ –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ Sprache –æ–±—ä—è–≤–ª–µ–Ω –º–µ—Ç–æ–¥ <code>SelectMany</code>. –ü–æ —Å–º—ã—Å–ª—É –æ–Ω –¥–µ–ª–∞–µ—Ç —Ç–æ –∂–µ —Å–∞–º–æ–µ, —á—Ç–æ –∏ <code>Then</code>. –¢–æ –µ—Å—Ç—å –∫–æ–¥ —Å <code>from</code> —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–µ–Ω —Ç–∞–∫–æ–π –∑–∞–ø–∏—Å–∏:</p><pre><code>Parse
    .Char(&#x27;(&#x27;)
    .Then(left =&gt; (left, List.Optional()))
    .Then((left, expr) =&gt; (left, expr, Char(&#x27;)&#x27;)
    .Then((_, expr, _) =&gt;
        new MustFilter(expr.GetOrDefault()?.ToList()));</code></pre><p>–°–∏–Ω—Ç–∞–∫—Å–∏—Å —Å <code>from</code> –Ω–∞–º–Ω–æ–≥–æ —á–∏—Ç–∞–µ–º–µ–µ, –Ω–∞ –º–æ–π –≤–∫—É—Å!</p><p>–ú–µ—Ç–æ–¥ <code>Optional</code> –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç —á–∞—Å—Ç—å –≤—ã—Ä–∞–∂–µ–Ω–∏—è ‚Äî –æ–Ω–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–π. –ú–µ—Ç–æ–¥ <code>GetOrDefault()</code> –Ω—É–∂–µ–Ω, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–∞—Ä—Å–∏–Ω–≥–∞ <code>Optional</code>-–≤—ã—Ä–∞–∂–µ–Ω–∏—è.</p><p>–ò –Ω–∞–∫–æ–Ω–µ—Ü, –º–æ–∂–Ω–æ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≥–æ—Ç–æ–≤—ã–º –ø–∞—Ä—Å–µ—Ä–æ–º:</p><pre><code>public static IFilter BuildFromText(string text)
{
    var normalizedText = new string(
        text
        .Where(c =&gt; !char.IsWhiteSpace(c))
        .ToArray());
    var input = new Input(normalizedText);
    var parser = Expr;
    var parsed = parser(input);
    if (!parsed.WasSuccessful)
    {
        throw new Exception(
            $&quot;Message: {parsed.Message}, &quot; +
            $&quot;Offset: {parsed.Remainder}&quot;);
    }
    return parsed.Value;
}</code></pre><p>–¢–µ–ø–µ—Ä—å –¥–∞–≤–∞–π—Ç–µ —Å—Ä–∞–≤–Ω–∏–º <a href="https://github.com/BurlakovNick/sprache-examples/blob/master/Parsers/ParserExamples/Example1/NaiveFilterParser.cs">–Ω–∞–∏–≤–Ω—ã–π –ø–∞—Ä—Å–µ—Ä</a> –∏ <a href="https://github.com/BurlakovNick/sprache-examples/blob/master/Parsers/ParserExamples/Example1/FilterParser.cs">—É–º–Ω—ã–π</a>. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å –ø–æ–º–æ—â—å—é Sprache –∫–æ–º–ø–∞–∫—Ç–Ω–µ–µ –∏ —Ç–æ—á—å-–≤-—Ç–æ—á—å —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –∏—Å—Ö–æ–¥–Ω–æ–π –≥—Ä–∞–º–º–∞—Ç–∏–∫–æ–π!</p><h2>–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</h2><p>–ë–æ–ª—å—à–æ–π –ª–∏ –æ–≤–µ—Ä—Ö–µ–¥ —É —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞ –∫ –Ω–∞–ø–∏—Å–∞–Ω–∏—é –ø–∞—Ä—Å–µ—Ä–æ–≤? –ü–æ–ø—Ä–æ–±—É–µ–º –Ω–∞–ø–∏—Å–∞—Ç—å –±–µ–Ω—á–º–∞—Ä–∫ —Å –ø–æ–º–æ—â—å—é <a href="https://github.com/dotnet/BenchmarkDotNet">Benchmark.net</a>.</p><p>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –±—É–¥–µ–º –Ω–∞ –¥–≤—É—Ö –Ω–µ—Å–ª–æ–∂–Ω—ã—Ö —Ç–µ—Å—Ç–∞—Ö:</p><ul><li>–¢–µ—Å—Ç —Å –±–æ–ª—å—à–æ–π –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å—é —Å–∫–æ–±–æ–∫. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Ç–∞–∫ ‚Äî –±—É–∫–≤—É <code>x</code> –∑–∞–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –≤ —Å–∫–æ–±–∫–∏ <code>()</code>, –ø–æ–ª—É—á–µ–Ω–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –≤ –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ —Å–∫–æ–±–∫–∏ <code>[]</code> ‚Äî –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ 500 —Ä–∞–∑. –ò—Ç–æ–≥–æ–≤–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ —Ä–∞–∑–º–Ω–æ–∂–∏—Ç—å —Ä–∞–∑ 100 –∏ –∑–∞–ø–∏—Å–∞—Ç—å –≤ –æ–¥–∏–Ω —Å–ø–∏—Å–æ–∫.</li><li>–¢–µ—Å—Ç —Å –¥–ª–∏–Ω–Ω—ã–º–∏ —Å–ø–∏—Å–∫–∞–º–∏. –ó–∞–ø–∏—à–µ–º –æ–¥–∏–Ω –±–æ–ª—å—à–æ–π —Å–ø–∏—Å–æ–∫ –∏–∑ 100 —Å–ø–∏—Å–∫–æ–≤, –≤ –∫–∞–∂–¥–æ–º –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é 500 —Ä–∞–∑ –ø–æ–≤—Ç–æ—Ä–∏–º —Å–∏–º–≤–æ–ª¬†<code>x</code>.</li></ul><p>–ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –±–µ–Ω—á–º–∞—Ä–∫–∞ –Ω–∞ <a href="https://github.com/BurlakovNick/sprache-examples/blob/master/Parsers/ParserBenchmark/Program.cs">Github</a>.</p><p>–ò—Ç–æ–≥–æ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:</p><pre><code>Method   |                     Text |     Mean |     Error |    StdDev |   Median |
-------- |------------------------- |---------:|----------:|----------:|---------:|
Sprache  | (([([(...)])])) [100201] | 655.3 ms |  9.674 ms |  9.049 ms | 652.2 ms |
Naive    | (([([(...)])])) [100201] | 651.9 ms | 12.898 ms | 27.487 ms | 639.8 ms |
Sprache  | ([x,x(...)x,x]) [100201] | 206.8 ms |  1.667 ms |  1.559 ms | 206.4 ms |
Naive    | ([x,x(...)x,x]) [100201] | 209.1 ms |  3.591 ms |  2.999 ms | 208.2 ms |</code></pre><p>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –Ω–µ –æ—Ç–ª–∏—á–∞—é—Ç—Å—è –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞. –†–∞–∑—É–º–µ–µ—Ç—Å—è, —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≥—Ä–∞–º–º–∞—Ç–∏–∫–∏, –ø–æ—ç—Ç–æ–º—É –µ—Å–ª–∏ –∑–∞—Ö–æ—Ç–∏—Ç–µ —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –º–µ–≥–∞–±–∞–π—Ç–Ω—ã–µ —Ñ–∞–π–ª—ã ‚Äî –ª—É—á—à–µ –Ω–∞–ø–∏—à–∏—Ç–µ —Å–≤–æ–π –±–µ–Ω—á–º–∞—Ä–∫.</p><h2>–ü—Ä–∏–º–µ—Ä DSL</h2><p>–ï—Å–ª–∏ –ø—Ä–∏–º–µ—Ä —Å –ø–∞—Ä—Å–∏–Ω–≥–æ–º —Å–∫–æ–±–æ—á–Ω—ã—Ö –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π —Å–ª–∏—à–∫–æ–º –ø—Ä–æ—Å—Ç–æ–π, —Ç–æ –¥–∞–≤–∞–π—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ –∑–∞–¥–∞—á–∫—É –∏–∑ –∂–∏–∑–Ω–∏.</p><p>–ù–∞ –º–æ–µ–π —Ä–∞–±–æ—Ç–µ —è –¥–µ–ª–∞—é –±–∏–ª–ª–∏–Ω–≥. –û–¥–Ω–∞ –∏–∑ —Ñ–∏—á –±–∏–ª–ª–∏–Ω–≥–∞ ‚Äî –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö –∏ –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø–æ —Å–¥–µ–ª–∫–µ —Å –∫–ª–∏–µ–Ω—Ç–æ–º. –î–æ–∫—É–º–µ–Ω—Ç—ã —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è –ø–æ —Å–ª–æ–∂–Ω—ã–º –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞–º, –≤ –∫–æ—Ç–æ—Ä—ã—Ö —á–µ—Ä—Ç –Ω–æ–≥—É —Å–ª–æ–º–∏—Ç. –ë–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ –∞–∫—Ç–∏–≤–Ω–æ –º–µ–Ω—è—é—Ç—Å—è ‚Äî –≤–º–µ—Å—Ç–µ —Å –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞, –ø–æ—è–≤–ª–µ–Ω–∏–µ–º –≤ –±–∏–ª–ª–∏–Ω–≥–µ –Ω–æ–≤—ã—Ö —Ç–∞—Ä–∏—Ñ–æ–≤ –∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤.</p><p>–ü—Ä–æ–±–ª–µ–º–∞ ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —ç—Ç–∏—Ö –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª –∑–∞–Ω–∏–º–∞—é—Ç—Å—è, –∫–æ–Ω–µ—á–Ω–æ –∂–µ, —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏. –≠—Ç–æ —Å–∫—É—á–Ω–æ (–ø—Ä–∞–≤–∏–ª–∞ –¥–æ–≤–æ–ª—å–Ω–æ –æ–¥–Ω–æ—Ç–∏–ø–Ω—ã–µ) –∏ —Å–æ–≤–µ—Ä—à–µ–Ω–Ω–æ –Ω–µ —Ç–∏—Ä–∞–∂–∏—Ä—É–µ–º–æ (—á–∏—Å–ª–æ –ø—Ä–∞–≤–∏–ª —Ä–∞—Å—Ç–µ—Ç, –∞ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –Ω–∞ —Ä—ã–Ω–∫–µ –Ω–µ —Ç–∞–∫ —É–∂ –∏ –º–Ω–æ–≥–æ).</p><p>–û–∫, –¥–∞–≤–∞–π—Ç–µ –∑–∞–±–µ—Ä–µ–º —É —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–∫—É—á–Ω—É—é –∑–∞–¥–∞—á—É –ø–æ –ø–æ–¥–¥–µ—Ä–∂–∫–µ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª! –ò –æ—Ç–¥–∞–¥–∏–º –∫–æ–º—É-–Ω–∏–±—É–¥—å –µ—â–µ. –Æ—Ä–∏—Å—Ç–∞–º, –Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–ª–∏ –µ—â–µ –∫–∞–∫–∏–º-–Ω–∏–±—É–¥—å —ç–∫—Å–ø–µ—Ä—Ç–∞–º –≤ –ø—Ä–µ–¥–º–µ—Ç–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ (–∫—Ç–æ –ø—Ä–∏–¥—É–º—ã–≤–∞–µ—Ç —ç—Ç–∏ –ø—Ä–∞–≤–∏–ª–∞). –ù–æ –µ—Å—Ç—å –æ–¥–∏–Ω –Ω—é–∞–Ω—Å ‚Äî —é—Ä–∏—Å—Ç—ã –Ω–µ —É–º–µ—é—Ç –ø–∏—Å–∞—Ç—å –∫–æ–¥ :(</p><p>–ù–∞ –ø–æ–º–æ—â—å –ø—Ä–∏—Ö–æ–¥—è—Ç <a href="https://en.wikipedia.org/wiki/Domain-specific_language">DSL</a> ‚Äî –ø—Ä–µ–¥–º–µ—Ç–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —è–∑—ã–∫. –≠—Ç–æ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —è–∑—ã–∫ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –ø—Ä–µ–¥–º–µ—Ç–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏. –ù–∞–ø—Ä–∏–º–µ—Ä, –º–æ–∂–Ω–æ –ø—Ä–∏–¥—É–º–∞—Ç—å —Å–≤–æ–π —è–∑—ã–∫ –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤. –° –ª—É–Ω–∞–ø–∞—Ä–∫–æ–º –∏ –¥–µ–≤–æ—á–∫–∞–º–∏!</p><p>–ü—Ä–µ–¥—Å—Ç–∞–≤–∏–º –ø—Ä–∞–≤–∏–ª–æ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞ –Ω–∞ —Ç–∞–∫–æ–º —è–∑—ã–∫–µ:</p><pre><code>ContractRule: {
    Product = Diadoc,
    Logic = {
        if (History.IsOfferScheme)
            return false;

        if (Bill.IsPostpay)
            return false;

        if (History.HasContract)
            return false;

        return Order.HasCloudCert || Order.HasSubscribeOrExtra;
    }
}</code></pre><p>–ü—Ä–∞–≤–∏–ª–æ ‚Äî –Ω–∞–±–æ—Ä —É—Å–ª–æ–≤–∏–π –∏–∑ <code>if</code>, <code>else</code> –∏ –±—É–ª–µ–≤—ã—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π. –≠–∫—Å–ø–µ—Ä—Ç –º–æ–∂–µ—Ç –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Å—Ç—ã–µ –∑–Ω–∞–Ω–∏—è –æ —Å–¥–µ–ª–∫–µ ‚Äî –≤—ã—Å—Ç–∞–≤–ª–µ–Ω –ª–∏ —Å—á–µ—Ç –Ω–∞ –ø–æ—Å—Ç–æ–ø–ª–∞—Ç—É (<code>Bill.IsPostpay</code>) –∏–ª–∏ –±—ã–ª –ª–∏ –¥–æ–≥–æ–≤–æ—Ä —Å –∫–ª–∏–µ–Ω—Ç–æ–º (<code>History.HasContract</code>), —á—Ç–æ–±—ã –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –Ω—É–∂–Ω–æ –ª–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç –ø–æ —Å–¥–µ–ª–∫–µ. –ü—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–æ—Å—Ç—ã—Ö —É—Å–ª–æ–≤–∏–π —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ (–æ–Ω–∏ –º–µ–Ω—è—é—Ç—Å—è –æ—á–µ–Ω—å —Ä–µ–¥–∫–æ). –ê —á–∞—Å—Ç–æ –º–µ–Ω—è—é—â–∏–µ—Å—è –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ –∂–∏–≤—É—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–π –∂–∏–∑–Ω—å—é.</p><p>–ü–∞—Ä—Å–µ—Ä –¥–ª—è –ø—Ä–∞–≤–∏–ª –ø–æ–ª—É—á–∞–µ—Ç—Å—è –æ—á–µ–Ω—å –∫–æ—Ä–æ—Ç–∫–∏–π. –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ <a href="https://github.com/BurlakovNick/sprache-examples/blob/master/Parsers/ParserExamples/Example2/Parsers/RuleParser.cs">–∑–¥–µ—Å—å</a>. –ú–µ–Ω—å—à–µ 100 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞!</p><p>–í –ø–∞—Ä—Å–µ—Ä–µ –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π, –Ω–∞–ø—Ä–∏–º–µ—Ä:</p><ul><li>–ù–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –≤–µ—Ç–≤–∏ <code>else</code>;</li><li>–ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Å–∫–æ–±–æ—á–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è;</li><li>–°–∏–ª—å–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –Ω–∞–±–æ—Ä –ø—Ä–æ—Å—Ç—ã—Ö —É—Å–ª–æ–≤–∏–π –ø–æ —Å–¥–µ–ª–∫–µ (–Ω–∞ –¥–µ–ª–µ –∏—Ö –Ω–∞–º–Ω–æ-–æ-–æ-–≥–æ –±–æ–ª—å—à–µ!);</li><li>–ù–µ –≤—ã–≤–æ–¥—è—Ç—Å—è –∫—Ä–∞—Å–∏–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö, –µ—Å–ª–∏ –ø—Ä–∞–≤–∏–ª–æ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –≥—Ä–∞–º–º–∞—Ç–∏–∫–µ.</li></ul><p>–¢–æ –µ—Å—Ç—å —ç—Ç–æ –±–æ–ª—å—à–µ proof-of-concept, —á–µ–º production-ready –ø–∞—Ä—Å–µ—Ä. –ù–æ! –í–µ—Å—å –∫–æ–¥ —Å–∏—Å—Ç–µ–º—ã –ø—Ä–∞–≤–∏–ª –∏ –ø–∞—Ä—Å–µ—Ä —è –Ω–∞–ø–∏—Å–∞–ª –≤—Å–µ–≥–æ –∑–∞ 2 —á–∞—Å–∞. –ë–µ–∑ Sprache —É—à–ª–æ –±—ã –Ω–∞ –ø–æ—Ä—è–¥–æ–∫ –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏, —á—Ç–æ–±—ã —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å —Ç–∞–∫—É—é –≥—Ä–∞–º–º–∞—Ç–∏–∫—É.</p><p>–ù—É –∏ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä—Å–µ—Ä—ã –¥—Ä—É–≥ —Å –¥—Ä—É–≥–æ–º —Å API Sprache ‚Äî —ç—Ç–æ –∫–∞–π—Ñ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ :)</p><h2>–ò—Ç–æ–≥–æ</h2><p>–ï—Å–ª–∏ –Ω—É–∂–Ω–æ —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å —Å–ª–æ–∂–Ω—ã–π —Ç–µ–∫—Å—Ç ‚Äî –Ω–µ –Ω–∞–¥–æ –∏–∑–æ–±—Ä–µ—Ç–∞—Ç—å –≤–µ–ª–æ—Å–∏–ø–µ–¥, –∏—Å–ø–æ–ª—å–∑—É–π –≥–æ—Ç–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã. Sprache –ø—Ä–µ–∫—Ä–∞—Å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç, —á—Ç–æ–±—ã –±—ã—Å—Ç—Ä–æ –Ω–∞–≤–∞—è—Ç—å –ø–∞—Ä—Å–µ—Ä.</p><p>–ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –≤—Å–µ—Ö –ø—Ä–∏–º–µ—Ä–æ–≤ –µ—Å—Ç—å –Ω–∞ <a href="https://github.com/BurlakovNick/sprache-examples">github</a>. –û—Å—Ç–∞–ª–∏—Å—å –≤–æ–ø—Ä–æ—Å—ã ‚Äî –ø–∏—à–∏, –ø–æ–æ–±—â–∞–µ–º—Å—è.</p></div></body></html>