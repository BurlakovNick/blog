<html><head><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0,user-scalable=0"><meta name="title" content="Nick is typing..."><meta name="description" content="Personal page with not-so-random shit"><title>–ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ —Å Elastic Search</title><link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üßë‚Äçüíª</text></svg>"><link rel="stylesheet" href="bear.css"/></head><body><div><h1 class='page_title' style='margin-top: 0.5em;'>üîé –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ —Å Elastic Search</h1><p>–í –ø—Ä–æ–µ–∫—Ç–µ, –∫–æ—Ç–æ—Ä—ã–π —è —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–ª –≤ <a href="https://kontur.ru/">–ö–æ–Ω—Ç—É—Ä–µ</a>, –º—ã —Ä–µ—à–∏–ª–∏ —Å–¥–µ–ª–∞—Ç—å –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ –ø–æ –æ—Å–Ω–æ–≤–Ω—ã–º —Å—É—â–Ω–æ—Å—Ç—è–º —Å–∏—Å—Ç–µ–º—ã. –ú—ã –Ω–µ –∏–∑–æ–±—Ä–µ–ª–∏ –≤–µ–ª–æ—Å–∏–ø–µ–¥ ‚Äî –≤–∑—è–ª–∏ <a href="https://www.elastic.co/products/elasticsearch">Elastic Search</a> –∏ –¥–æ—Ç—é–Ω–∏–ª–∏ –¥–æ –Ω–∞—à–∏—Ö –Ω—É–∂–¥. Elastic Search –¥–∞–µ—Ç –±–æ–≥–∞—Ç—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö, –≤ –æ–±—â–µ–º ‚Äî –∫–ª–∞—Å—Å–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç. –õ–æ–≥–∏–∫–∞ –ø–æ–∏—Å–∫–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Elastic —É–º–µ—â–∞–µ—Ç—Å—è –≤—Å–µ–≥–æ –≤ –ø–∞—Ä—É —Å–æ—Ç–µ–Ω —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞. –ö–æ–¥ –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π, –Ω–æ –∑–∞ –Ω–∏–º —Å–ø—Ä—è—Ç–∞–Ω–æ –ø–∞—Ä–æ—á–∫–∞ —Ö–∞–∫–æ–≤ –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ Elastic Search. –í —Å—Ç–∞—Ç—å–µ —Ö–æ—á—É —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –æ —Ñ–∏—à–∫–∞—Ö –≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ–∏—Å–∫–∞.</p><h2>–ß—Ç–æ –∏—â–µ–º</h2><p>–ü—Ä–æ–µ–∫—Ç ‚Äî —ç—Ç–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –±–∏–ª–ª–∏–Ω–≥ –∫–æ–º–ø–∞–Ω–∏–∏ (–ö–æ–Ω—Ç—É—Ä.–ë–∏–ª–ª–∏–Ω–≥), –æ–¥–∏–Ω –∏–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ‚Äî –ø—Ä–æ–¥–∞–≤—Ü—ã. –ü—Ä–æ–¥–∞–≤—Ü—É –Ω—É–∂–Ω–æ –±—ã—Å—Ç—Ä–æ –Ω–∞–π—Ç–∏ –∫–ª–∏–µ–Ω—Ç–∞ –≤ –Ω–∞—à–µ–π —Å–∏—Å—Ç–µ–º–µ –ø–æ –ª—é–±–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä–∞—è —É –Ω–µ–≥–æ –µ—Å—Ç—å ‚Äî –§–ò–û, –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞, email, –ò–ù–ù, –Ω–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞. –î–ª—è –ø—Ä–æ–¥–∞–≤—Ü–∞ –ø–æ–∏—Å–∫ –≤—ã–≥–ª—è–¥–∏—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫</p><img src="img/f81f071a-0109-4192-ac72-aa25a2a9ea72.gif" style="display: block; margin-left: auto; margin-right: auto"></img><div></div><p>–°—Ç—Ä–æ–∫–∞ –ø–æ–∏—Å–∫–∞ ‚Äî –æ–±—ã—á–Ω—ã–π autocomplete. –ü–æ–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–±–∏—Ä–∞–µ—Ç –∑–∞–ø—Ä–æ—Å, –≤—Å–ø–ª—ã–≤–∞—é—Ç –ø–æ–¥—Å–∫–∞–∑–∫–∏ —Å –Ω–∞–π–¥–µ–Ω–Ω—ã–º–∏ –∫–ª–∏–µ–Ω—Ç–∞–º–∏.</p><p>–ö—Ä–æ–º–µ –∑–∞–ø–∏—Å–µ–π –æ –∫–ª–∏–µ–Ω—Ç–µ, –≤ –ø–æ–∏—Å–∫–µ –∏—â—É—Ç –∑–∞—è–≤–∫–∏ –ø–æ —Ä–∞–±–æ—Ç–µ —Å –∫–ª–∏–µ–Ω—Ç–æ–º, –∑–∞–∫–∞–∑—ã, –∫–æ–Ω—Ç–∞–∫—Ç—ã, —Å—á–µ—Ç–∞, —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏ –ø—Ä–æ—á–µ–µ.</p><p>–î–ª—è –∫–∞–∂–¥–æ–π —Å—É—â–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã –º—ã —Ö—Ä–∞–Ω–∏–º –¥–æ–∫—É–º–µ–Ω—Ç –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ–ª–µ–π:</p><ul><li>–¢–µ–∫—Å—Ç, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç;</li><li>–ú–µ—Ç–∞-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ–∫—É–º–µ–Ω—Ç–µ ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞;</li><li>–°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –≤–∏–¥–µ—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç.</li></ul><p>–¢–µ–∫—Å—Ç –ø–æ-—Ä–∞–∑–Ω–æ–º—É —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π ‚Äî –ø–æ –∫–ª–∏–µ–Ω—Ç—É —ç—Ç–æ –ò–ù–ù-–ö–ü–ü –∫–ª–∏–µ–Ω—Ç–∞ –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ (–ö–æ–Ω—Ç—É—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ B2B, –ø–æ—ç—Ç–æ–º—É –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É—é—Ç—Å—è –ø–æ —Ä–µ–∫–≤–∏–∑–∏—Ç–∞–º), –¥–ª—è –∑–∞—è–≤–∫–∏ ‚Äî –§–ò–û –∫–ª–∏–µ–Ω—Ç–∞ –∏ —Ç–µ–ª–µ—Ñ–æ–Ω, –∫–æ—Ç–æ—Ä—ã–π –æ–Ω –æ—Å—Ç–∞–≤–∏–ª –≤ –∑–∞—è–≤–∫–µ, –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ.</p><h2>–ò–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö</h2><p>–î–∞–Ω–Ω—ã–µ –≤ –ë–∏–ª–ª–∏–Ω–≥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –±–∞–∑–∞—Ö –¥–∞–Ω–Ω—ã—Ö, –≤ –æ—Å–Ω–æ–≤–Ω–æ–º ‚Äî –≤¬†Microsoft SQL –∏ Apache Cassandra. –ï—Å—Ç—å –∏–Ω–¥–µ–∫—Å–∏—Ä—É—é—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ—Å—ã–ø–∞–µ—Ç—Å—è –ø–æ <a href="https://ru.wikipedia.org/wiki/Cron">—Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é</a>, –≤—ã—á–∏—Ç—ã–≤–∞–µ—Ç –∏–∑–º–µ–Ω–∏–≤—à–∏–µ—Å—è –¥–∞–Ω–Ω—ã–µ –∏–∑ –±–∞–∑—ã, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏—Ö –≤ Elastic. Elastic —Ö—Ä–∞–Ω–∏—Ç –ª–∏—à—å –∫–æ–ø–∏—é –¥–∞–Ω–Ω—ã—Ö, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –¥–ª—è –ø–æ–∏—Å–∫–∞.</p><p>–í —á–µ–º –ø–ª—é—Å—ã —Ç–∞–∫–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞:</p><ul><li>–í –æ—Ç–ª–∏—á–∏–µ –æ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –∑–∞–ø–∏—Å–∏ (–∑–∞–ø–∏—Å–∞–ª–∏ –≤ –ë–î ‚Äî —Å—Ä–∞–∑—É –∑–∞–ø–∏—Å–∞–ª–∏ –≤ Elastic) –ø–æ–ª—É—á–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å. –ë—ã–≤–∞–µ—Ç —Ç–∞–∫, —á—Ç–æ Elastic —Ç—É–ø–∏—Ç –∏ –Ω–µ –º–æ–∂–µ—Ç –∑–∞–ø–∏—Å–∞—Ç—å –¥–∞–Ω–Ω—ã–µ (<a href="https://ru.wikipedia.org/wiki/%D0%A1%D0%B1%D0%BE%D1%80%D0%BA%D0%B0_%D0%BC%D1%83%D1%81%D0%BE%D1%80%D0%B0">–¥–æ–ª–≥–æ —Å–æ–±–∏—Ä–∞–µ—Ç –º—É—Å–æ—Ä</a>, <a href="https://aphyr.com/posts/288-the-network-is-reliable">—Ç—É–ø–∞–Ω—É–ª–∞ —Å–µ—Ç—å</a>). –ß—Ç–æ –¥–µ–ª–∞—Ç—å –ø—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –∑–∞–ø–∏—Å–∏ –Ω–µ—è—Å–Ω–æ ‚Äî –¥–∞–Ω–Ω—ã–µ —É–∂–µ –µ—Å—Ç—å –≤ –ë–î, –∞ –≤ Elastic –Ω–µ—Ç, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ –∑–∞–ø–∏—Å–∞—Ç—å –≤ Elastic –Ω–µ–ª—å–∑—è. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç <a href="https://en.wikipedia.org/wiki/Eventual_consistency">eventual consistency</a> ‚Äî –¥–∞–Ω–Ω—ã–µ –≤ –∫–æ–Ω–µ—á–Ω–æ–º —Å—á–µ—Ç–µ –æ–∫–∞–∂—É—Ç—Å—è –≤ Elastic. –ï—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å –∑–∞–ø–∏—Å–∞—Ç—å —Å—Ä–∞–∑—É, —Ç–æ –ø—Ä–æ—Ü–µ—Å—Å –ø–æ–≤—Ç–æ—Ä–∏—Ç –ø–æ–ø—ã—Ç–∫—É –ø–æ–∑–∂–µ;</li><li>Elastic –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –ø–µ—Ä–≤–∏—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ. –î–∞–Ω–Ω—ã–µ –º–æ–∂–Ω–æ –±–µ–∑–±–æ–ª–µ–∑–Ω–µ–Ω–Ω–æ –ø–æ—Ç–µ—Ä—è—Ç—å –∏ –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏–Ω–¥–µ–∫—Å –∑–∞–Ω–æ–≤–æ. –ü–∞—Ä—É —Ä–∞–∑ —ç—Ç–æ –∑–¥–æ—Ä–æ–≤–æ –≤—ã—Ä—É—á–∞–ª–æ –º–µ–Ω—è, –∫–æ–≥–¥–∞ –¥–µ–ª–∞–ª –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ö–µ–º—ã –¥–∞–Ω–Ω—ã—Ö ‚Äî —è –∑–∞–±–∏–ª –Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫—É –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏, —Å–æ–∑–¥–∞–ª –Ω–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å, –Ω–∞–∫–∞—á–∞–ª –µ–≥–æ –¥–∞–Ω–Ω—ã–º–∏ –∏ –ø–µ—Ä–µ–∫–ª—é—á–∏–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ —á—Ç–µ–Ω–∏–µ –∏–∑ –Ω–æ–≤–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞.</li></ul><p>–í —á–µ–º –º–∏–Ω—É—Å—ã:</p><ul><li>–ï—Å—Ç—å –∑–∞–¥–µ—Ä–∂–∫–∞ –Ω–∞ –ø–æ—è–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –ø–æ–∏—Å–∫–µ, –ø–æ—Å–∫–æ–ª—å–∫—É –∏–Ω–¥–µ–∫—Å–∏—Ä—É—é—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é. –ó–∞–¥–µ—Ä–∂–∫—É –º–æ–∂–Ω–æ —É–º–µ–Ω—å—à–∞—Ç—å, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—è –≤—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞;</li><li>–ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ –≤ –Ω–∞—à–µ–π –æ–¥–Ω–æ–ø–æ—Ç–æ—á–Ω–æ–π —Å—Ö–µ–º–µ ‚Äî –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Å–ª–∏—à–∫–æ–º –º–µ–¥–ª–µ–Ω–Ω–∞—è, –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –º–Ω–æ–≥–æ. –í –ë–∏–ª–ª–∏–Ω–≥–µ –Ω–µ–±–æ–ª—å—à–æ–π –∏–Ω–¥–µ–∫—Å –Ω–∞ –¥–µ—Å—è—Ç–∫–∏ –≥–∏–≥–∞–±–∞–π—Ç –∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–µ—Å—è—Ç–∫–æ–≤ –º–∏–ª–ª–∏–æ–Ω–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤. –ï–≥–æ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –∑–∞–Ω–∏–º–∞–µ—Ç 10-12 —á–∞—Å–æ–≤. –ù–µ —Å–ª–∏—à–∫–æ–º –±—ã—Å—Ç—Ä–æ ‚Äî –Ω–æ –ø–æ–∫–∞ –Ω–∞—Å —É—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç.</li></ul><p>–ï—Å—Ç—å –ø—Ä–∏–∫–æ–ª—å–Ω—ã–π –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ —Å –ø–æ–º–æ—â—å—é –æ—á–µ—Ä–µ–¥–∏ —Å–æ–æ–±—â–µ–Ω–∏–π ‚Äî –∑–∞–ø–∏—Å—ã–≤–∞–µ–º –≤—Å–µ —Å–æ–±—ã—Ç–∏—è –ø–æ –∏–∑–º–µ–Ω–µ–Ω–∏—é —Å—É—â–Ω–æ—Å—Ç–µ–π –≤ –æ—á–µ—Ä–µ–¥—å <a href="http://kafka.apache.org/">Kafka</a>, –∞ –ø–æ—Ç–æ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–Ω–¥–µ–∫—Å–∏—Ä—É—é—â–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ —Ä–∞–∑–≥—Ä–µ–±–∞—é—Ç –æ—á–µ—Ä–µ–¥—å —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –∏–Ω–¥–µ–∫—Å–∏—Ä—É—é—Ç –¥–æ–∫—É–º–µ–Ω—Ç—ã –≤ Elastic. –ü–æ–¥—Ö–æ–¥ —Å –æ—á–µ—Ä–µ–¥—å—é –ª—É—á—à–µ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è. –ü—Ä–∏–º–µ—Ä –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ —Å –ø–æ–º–æ—â—å—é –æ—á–µ—Ä–µ–¥–∏ –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ <a href="https://github.com/BigDataDevs/kafka-elasticsearch-consumer">Github</a>.</p><h2>–ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—Å—Ç–∞</h2><p>–û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –≤ Elastic ‚Äî —ç—Ç–æ <a href="https://ru.wikipedia.org/wiki/%D0%98%D0%BD%D0%B2%D0%B5%D1%80%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%BD%D1%8B%D0%B9_%D0%B8%D0%BD%D0%B4%D0%B5%D0%BA%D1%81">–∏–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–Ω–¥–µ–∫—Å</a>. –≠—Ç–æ –∏–Ω–¥–µ–∫—Å, –≤ –∫–æ—Ç–æ—Ä–æ–º –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–ª–æ–≤–∞ —Ö—Ä–∞–Ω–∏—Ç—Å—è, –≤ –∫–∞–∫–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö –æ–Ω–æ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è.</p><img src="img/532baf23-8935-4ea2-b4cb-1ec4b1aa05db.svg" style="display: block; margin-left: auto; margin-right: auto"></img><div></div><p>–¢–∞–∫–æ–π –∏–Ω–¥–µ–∫—Å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–µ–Ω, –∫–æ–≥–¥–∞ –º—ã –∏—â–µ–º –¥–æ–∫—É–º–µ–Ω—Ç—ã —Å –≤—Ö–æ–∂–¥–µ–Ω–∏–µ–º —Å–ª–æ–≤–∞. –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –Ω–∞–π—Ç–∏ –≤—Ö–æ–∂–¥–µ–Ω–∏—è –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ —Å–ª–æ–≤, —Ç–æ –º–æ–∂–Ω–æ –≤–∑—è—Ç—å —Å–ø–∏—Å–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–ª–æ–≤–∞ –∏ –ø–µ—Ä–µ—Å–µ—á—å –∏—Ö.</p><p>–ß—Ç–æ–±—ã –ø–æ—Å—Ç—Ä–æ–∏—Ç—å —Ç–∞–∫–æ–π –∏–Ω–¥–µ–∫—Å, Elastic –ø—Ä–æ–≥–æ–Ω—è–µ—Ç —Ç–µ–∫—Å—Ç —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —à–∞–≥–æ–≤:</p><img src="img/5c3b852d-8539-418f-9f55-d3028bedbbba.png" style="display: block; margin-left: auto; margin-right: auto"></img><div></div><ol><li>CharFilter ‚Äî —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö. –ó–¥–µ—Å—å –æ—Ç–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è —Å–∏–º–≤–æ–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –Ω–µ—Å—É—Ç –ø–æ–ª–µ–∑–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã, html-–≤–µ—Ä—Å—Ç–∫–∞.</li><li>Tokenizer ‚Äî —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏—è, —Ç–æ –µ—Å—Ç—å —Ä–∞–∑–±–∏–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –Ω–∞ —Å–ª–æ–≤–∞.</li><li>TokenFilter ‚Äî –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö —Å–ª–æ–≤. –ù–∞–ø—Ä–∏–º–µ—Ä, –∫–∞–∂–¥–æ–µ —Å–ª–æ–≤–æ –º–æ–∂–Ω–æ –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É –∏–ª–∏ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Å–ª–æ–≤–æ-—Å–∏–Ω–æ–Ω–∏–º. –ú–æ–∂–Ω–æ –≤–æ–æ–±—â–µ –≤—ã–∫–∏–Ω—É—Ç—å —Å–ª–æ–≤–æ –∏–∑ –∏–Ω–¥–µ–∫—Å–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ—Ü–µ–Ω–∑—É—Ä–Ω–æ–µ —Å–ª–æ–≤–æ.</li></ol><h2>–ü–æ–∏—Å–∫</h2><p>–ü–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –≤ Elastic —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö —á–∞—Å—Ç–µ–π ‚Äî <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-filter-context.html">Filter –∏ Query</a>.</p><ul><li>Filter ‚Äî –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å &quot;–ø–æ–¥—Ö–æ–¥–∏—Ç –ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç –ø–æ–¥ —É—Å–ª–æ–≤–∏—è –ø–æ–∏—Å–∫–∞&quot;;</li><li>Query ‚Äî &quot;–Ω–∞—Å–∫–æ–ª—å–∫–æ —Ö–æ—Ä–æ—à–æ –¥–æ–∫—É–º–µ–Ω—Ç –ø–æ–¥—Ö–æ–¥–∏—Ç –ø–æ–¥ —É—Å–ª–æ–≤–∏—è –ø–æ–∏—Å–∫–∞&quot;.</li></ul><p>–û—Ç–ª–∏—á–∏–µ Query –≤ —Ç–æ–º, —á—Ç–æ –∫—Ä–æ–º–µ —Ñ–æ—Ä–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ &quot;–ø–æ–¥—Ö–æ–¥–∏—Ç&quot; ‚Äî &quot;–Ω–µ¬†–ø–æ–¥—Ö–æ–¥–∏—Ç&quot;, –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –µ—â–µ –∏ <a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/scoring-theory.html">—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å</a> –ø–æ–¥—Ö–æ–¥—è—â–µ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞. –í—Å–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –∑–∞—Ç–µ–º —Ä–∞–Ω–∂–∏—Ä—É—é—Ç—Å—è –ø–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏. <a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/practical-scoring-function.html">–§–æ—Ä–º—É–ª–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏</a> ‚Äî —Ö–∏—Ç—Ä—ã–π –º–∞—Ç–∞–Ω–∞–ª–∏–∑, –Ω–æ –∫–æ—Ä–æ—Ç–∫–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —Ç–∞–∫:</p><ul><li>–†–µ–ª–µ–≤–∞–Ω—Ç–Ω–µ–µ —Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã, –≥–¥–µ –±–æ–ª—å—à–µ –≤—Ö–æ–∂–¥–µ–Ω–∏–π –∏—Å–∫–æ–º—ã—Ö —Å–ª–æ–≤;</li><li>–ú–µ–Ω–µ–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã —Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã, –≥–¥–µ –≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è —Å–∞–º—ã–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —Å–ª–æ–≤–∞ –≤ –∏–Ω–¥–µ–∫—Å–µ. –ù–∞–ø—Ä–∏–º–µ—Ä, —Å–æ—é–∑—ã, –ø—Ä–µ–¥–ª–æ–≥–∏, –≤–≤–æ–¥–Ω—ã–µ —Å–ª–æ–≤–∞ –≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è –≤–æ –≤—Å–µ—Ö —Ç–µ–∫—Å—Ç–∞—Ö ‚Äî –∏ —Å–ª–∞–±–æ –≤–ª–∏—è—é—Ç –Ω–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞;</li><li>–ö–æ—Ä–æ—Ç–∫–∏–µ —Ç–µ–∫—Å—Ç—ã –±–æ–ª–µ–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã (–≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –≤—Å—Ç—Ä–µ—Ç–∏—Ç—å –∏—Å–∫–æ–º–æ–µ —Å–ª–æ–≤–æ –≤ –∫–æ—Ä–æ—Ç–∫–æ–º —Ç–µ–∫—Å—Ç–µ –º–µ–Ω—å—à–µ, —á–µ–º –≤ –¥–ª–∏–Ω–Ω–æ–º).</li></ul><p>–°–∞–º—ã–µ –ø—Ä–æ—Å—Ç—ã–µ —Å–ø–æ—Å–æ–±—ã –Ω–∞–π—Ç–∏ —á—Ç–æ-—Ç–æ ‚Äî –∑–∞–ø—Ä–æ—Å—ã match –∏ phrase.</p><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query.html">Match</a> –∑–∞–ø—Ä–æ—Å ‚Äî –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –Ω–∞ –≤—Ö–æ–¥ —Ç–µ–∫—Å—Ç –∑–∞–ø—Ä–æ—Å–∞, –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –µ–≥–æ, –∏—â–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç—ã —Å–æ —Å–ª–æ–≤–∞–º–∏ –∏–∑ —Ç–µ–∫—Å—Ç–∞. –ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ —Ö–æ—Ç–∏–º –Ω–∞–π—Ç–∏ –≤—Å–µ —Å–ª–æ–≤–∞ –∏–∑ –∑–∞–ø—Ä–æ—Å–∞, —Ç–æ –ø–æ–¥–æ–π–¥–µ—Ç —Ç–∞–∫–æ–π –∑–∞–ø—Ä–æ—Å:</p><pre><code>{
    &quot;query&quot;: {
        &quot;match&quot; : {
            &quot;message&quot; : {
                &quot;query&quot; : &quot;–≤—Å–µ —Å–ª–æ–≤–∞ –¥–æ–ª–∂–Ω—ã –≤—Å—Ç—Ä–µ—Ç–∏—Ç—å—Å—è –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ&quot;,
                &quot;operator&quot; : &quot;and&quot;
            }
        }
    }
}
</code></pre><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query-phrase.html">Match Phrase</a> ‚Äî —Ç–æ –∂–µ —Å–∞–º–æ–µ, —á—Ç–æ Match, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞, —á—Ç–æ–±—ã —Å–ª–æ–≤–∞ –≤—Å—Ç—Ä–µ—á–∞–ª–∏—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ. –ù–µ –≤—Å–µ —Å–ª–æ–≤–∞ –æ–±—è–∑–∞–Ω—ã –∏–¥—Ç–∏ —Å—Ç—Ä–æ–≥–æ –¥—Ä—É–≥ –∑–∞ –¥—Ä—É–≥–æ–º –≤ —Ç–µ–∫—Å—Ç–µ, –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —á–∏—Å–ª–æ —Å–ª–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–∑–¥–µ–ª—è—é—Ç –¥–≤–∞ –∏—Å–∫–æ–º—ã—Ö —Å–ª–æ–≤–∞ –≤–æ —Ñ—Ä–∞–∑–µ, —Å –ø–æ–º–æ—â—å—é –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ <code>slop</code>.</p><pre><code>{
    &quot;query&quot;: {
        &quot;match_phrase&quot; : {
            &quot;message&quot; : &quot;–∏—â–µ–º —Ç–æ—á–Ω–æ–µ –≤—Ö–æ–∂–¥–µ–Ω–∏–µ —Ñ—Ä–∞–∑—ã –≤ —Ç–µ–∫—Å—Ç–µ&quot;,
            &quot;slop&quot;: 0
        }
    }
}
</code></pre><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query-phrase-prefix.html">Match Phrase Prefix</a> ‚Äî –≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç Match Phrase, —É –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–ª–æ–≤–∞ –∏—â–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –ø—Ä–µ—Ñ–∏–∫—Å–∞.</p><pre><code>{
    &quot;query&quot;: {
        &quot;match_phrase_prefix&quot; : {
            &quot;message&quot; : {
                &quot;query&quot; : &quot;–∏—â–µ–º –≤—Ö–æ–∂–¥–µ&quot;,
                &quot;max_expansions&quot; : 10
            }
        }
    }
}
</code></pre><p>–î–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ autocomplete –ø–æ–¥—Ö–æ–¥–∏—Ç <code>match_phrase_prefix</code>. –û–¥–Ω–∞–∫–æ, —ç—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å —Å—Ç–æ–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Å –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å—é ‚Äî –æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–æ, –ø–æ—Å–∫–æ–ª—å–∫—É –≤—ã–±–∏—Ä–∞–µ—Ç –ª–∏—à—å <code>max_expansions</code> —Å–ª–æ–≤ –≤ –∏–Ω–¥–µ–∫—Å–µ, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å –≤—Ö–æ–∂–¥–µ–Ω–∏—è –ø—Ä–µ—Ñ–∏–∫—Å–∞ (–≤ –Ω–∞—à–µ–º –∑–∞–ø—Ä–æ—Å–µ ‚Äî <code>–≤—Ö–æ–∂–¥–µ</code>), –∞ –ø–æ—Ç–æ–º –∏—â–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç—ã —Å —Ç–∞–∫–∏–º–∏ —Å–ª–æ–≤–∞–º–∏. –ü—Ä–∏ —Å–ª–∏—à–∫–æ–º –º–∞–ª–µ–Ω—å–∫–æ–º max_expansions –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –Ω—É–∂–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç, –ø—Ä–∏ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–º ‚Äî –ø–æ–∏—Å–∫ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –º–µ–¥–ª–µ–Ω–Ω–æ.</p><h2>–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–∞</h2><p>–ë–∏–ª–ª–∏–Ω–≥ —Ö—Ä–∞–Ω–∏—Ç —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏. –ü–æ—ç—Ç–æ–º—É –ª—é–±–æ–π –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∞–≤—Ç–æ—Ä–∏–∑—É–µ—Ç—Å—è. –î–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º –≤ –ø–æ–∏—Å–∫–µ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω Access Control List.</p><p><a href="https://ru.wikipedia.org/wiki/ACL">Access Control List</a> (ACL) ‚Äî –ø–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è –∏–∑–±–∏—Ä–∞—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–æ–∫—É–º–µ–Ω—Ç—É. –í –¥–æ–∫—É–º–µ–Ω—Ç–µ –º—ã —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–º –¥–æ—Å—Ç—É–ø–µ–Ω —ç—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç. –í –ë–∏–ª–ª–∏–Ω–≥–µ —Ä–∞–∑–º–µ—Ä ACL –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –¥–µ—Å—è—Ç–∫–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –ø–æ—ç—Ç–æ–º—É –¥–æ–∫—É–º–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç—Å—è –Ω–µ —Å–ª–∏—à–∫–æ–º –ø—É—Ö–ª—ã–π. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ ACL –¥–µ–ª–∞–µ—Ç—Å—è —Ç–∞–∫ ‚Äî –∫ –ª—é–±–æ–º—É –∑–∞–ø—Ä–æ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Elastic –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å –ø–æ –≤–ª–æ–∂–µ–Ω–Ω–æ–º—É –¥–æ–∫—É–º–µ–Ω—Ç—É <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.0//query-dsl-nested-query.html">(Nested query)</a>.</p><p>–ü—Ä–∏–º–µ—Ä —Ñ–∏–ª—å—Ç—Ä–∞:</p><pre><code>{
  &quot;filter&quot;: [{
    &quot;nested&quot;: {
      &quot;path&quot;: &quot;accessControlList&quot;,
      &quot;query&quot;: {
        &quot;bool&quot;: {
          &quot;filter&quot;: [{
            &quot;term&quot;: {
              &quot;accessControlList.userId&quot;: {
                &quot;value&quot;: &quot;d32c608c4d484a058bcf759e3c68eb28&quot;
              }
            }
          }]
        }
      }
    }
  }]
}
</code></pre><p>–í Nested-—Ñ–∏–ª—å—Ç—Ä–µ —É–∫–∞–∑–∞–Ω –ø—É—Ç—å <code>path</code> –¥–æ –≤–ª–æ–∂–µ–Ω–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞. –í–æ –≤–ª–æ–∂–µ–Ω–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ —Ñ–∏–ª—å—Ç—Ä—É–µ–º –ø–æ <code>userId</code> ‚Äî –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.</p><h2>&quot;–û–±—ä—è—Å–Ω–∏&quot; ‚Äî API</h2><p>–î–ª—è –Ω–µ–∏—Å–∫—É—à–µ–Ω–Ω–æ–≥–æ –∏–Ω–∂–µ–Ω–µ—Ä–∞ –ø–æ–∏—Å–∫ –≤ Elastic —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –º–∞–≥–∏—è. –ò–Ω–æ–≥–¥–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—á–µ—Å–∫–∏ –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ, –ø–æ—á–µ–º—É –¥–æ–∫—É–º–µ–Ω—Ç –ø–æ–¥–æ—à–µ–ª –ø–æ–¥ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –ø–æ–∏—Å–∫–∞. –ú–Ω–µ –∫–∞–∂–µ—Ç—Å—è, —è –ø–æ—Ç—Ä–∞—Ç–∏–ª —á–µ–ª–æ–≤–µ–∫–æ-–¥–Ω–∏ –Ω–∞ –º–µ–¥–∏—Ç–∞—Ü–∏—é –Ω–∞–¥ –Ω–µ–∫–æ—Ç–æ—Ä—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏, –∫–æ–≥–¥–∞ —Ç–æ–ª—å–∫–æ –Ω–∞—á–∏–Ω–∞–ª –∏–∑—É—á–∞—Ç—å Elastic.</p><p>–ß—Ç–æ–±—ã –ø–æ–Ω–∏–º–∞—Ç—å —Ä–∞–±–æ—Ç—É Elastic, –Ω–µ –Ω—É–∂–Ω–æ —Ä–∞–∑–±–∏—Ä–∞—Ç—å—Å—è –≤ –µ–≥–æ –∏—Å—Ö–æ–¥–Ω–∏–∫–∞—Ö. –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–∞–ª–∏ –¥–≤–∞ —É–¥–æ–±–Ω—ã—Ö API:</p><ul><li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-analyze.html">Analyze API</a> ‚Äî –ø—Ä–æ–≥–æ–Ω—è–µ—Ç —Ç–µ–∫—Å—Ç —á–µ—Ä–µ–∑ —É–∫–∞–∑–∞–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫–∏–µ —Å–ª–æ–≤–∞ Elastic —Å–æ—Ö—Ä–∞–Ω–∏—Ç –≤ –∏–Ω–¥–µ–∫—Å.</li><li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.3/search-explain.html">Explain API</a> ‚Äî –æ–±—ä—è—Å–Ω—è–µ—Ç, –ø–æ—á–µ–º—É –¥–æ–∫—É–º–µ–Ω—Ç –ø–æ–¥—Ö–æ–¥–∏—Ç –∏–ª–∏ –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –ø–æ–¥ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –ø–æ–∏—Å–∫–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞ –∏ –∫–∞–∫ –æ–Ω–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∞.</li></ul><p>–Ø –∏—Å–ø–æ–ª—å–∑—É—é —ç—Ç–∏ API –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:</p><ul><li>–ï—Å–ª–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é —Å–≤–æ–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –∏ —Ö–æ—á—É –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –∫–∞–∫ –æ–Ω–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç (–æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ –≥–¥–µ-—Ç–æ —Ñ–∏–≥—É—Ä–∏—Ä—É—é—Ç —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è);</li><li>–ö–æ–≥–¥–∞ –ø–æ–∏—Å–∫ –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç –Ω—É–∂–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –∏–ª–∏ –Ω–∞—Ö–æ–¥–∏—Ç –ª–∏—à–Ω–∏–π;</li><li>–ö–æ–≥–¥–∞ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã, –Ω–æ –±–æ–ª–µ–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤ –≤—ã–¥–∞—á–µ –Ω–∏–∂–µ –º–µ–Ω–µ–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö. –¢–æ–≥–¥–∞ –ª–µ–∑—É –≤¬†Explain¬†API –∏ –∑–∞—Ä—ã–≤–∞—é—Å—å –≤ —Ñ–æ—Ä–º—É–ª—É —Ä–∞—Å—á–µ—Ç–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏.</li></ul><h2>–¢—é–Ω–∏–º —É–¥–æ–±—Å—Ç–≤–æ –ø–æ–∏—Å–∫–∞</h2><p>–°–¥–µ–ª–∞—Ç—å –ø–æ–∏—Å–∫ —É–¥–æ–±–Ω—ã–º –∏ –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω—ã–º –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –º–æ–∂–Ω–æ —Å –ø–æ–º–æ—â—å—é –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∞–Ω–∞–ª–∏–∑–∞.</p><p>–ü—Ä–∏–º–µ—Ä ‚Äî –ø–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏. –ù–µ –≤—Å–µ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ç–æ—á–Ω–æ –∑–Ω–∞–µ—Ç, –∫–∞–∫ –Ω–∞–∑–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ –ë–∏–ª–ª–∏–Ω–≥–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–ø–æ–º–Ω–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–∞–∫–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏, –∫–∞–∫ –û–û–û &quot;–°–æ—é–∑ —Å–≤—è—Ç–æ–≥–æ –ò–æ–∞–Ω–Ω–∞¬†–í–æ–∏–Ω–∞!&quot; –û–∫, –±—É–¥–µ–º –∏—Å–∫–∞—Ç—å –Ω–µ—Ç–æ—á–Ω—ã–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –ø–æ –ø–æ–¥—Å—Ç—Ä–æ–∫–µ.</p><p>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∏–∂–µ –≤–∫–ª—é—á–∞–µ—Ç –ø–æ–∏—Å–∫ –ø–æ –ø–æ–¥—Å—Ç—Ä–æ–∫–∞–º (<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-ngram-tokenizer.html">ngram&#x27;–∞–º</a>).</p><pre><code>{
  &quot;analysis&quot;: {
    &quot;filter&quot;: {
      &quot;tokenfilter_ngram&quot;: {
        &quot;type&quot;: &quot;nGram&quot;,
        &quot;min_gram&quot;: &quot;2&quot;,
        &quot;max_gram&quot;: &quot;20&quot;
      }
    }
  }
}
</code></pre><p>–ü—Ä–∏ –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–ª–æ–≤–∞ –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤—Å–µ –µ–≥–æ –ø–æ–¥—Å—Ç—Ä–æ–∫–∏, –¥–ª–∏–Ω–Ω–æ–π –æ—Ç <code>min_gram</code> –¥–æ <code>max_gram</code>. –ò–∑ ngram&#x27;–æ–≤ –≤ —Å–æ—á–µ—Ç–∞–Ω–∏–∏ —Å –∑–∞–ø—Ä–æ—Å–æ–º <code>match</code> –º–æ–∂–Ω–æ —Å–æ—Å—Ç—Ä—è–ø–∞—Ç—å –Ω–µ–ø–ª–æ—Ö–æ–µ –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–∏—Å–∫–∞.</p><p>–ü–æ–ø—Ä–æ–±—É–µ–º –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä—É –≤ Elastic:</p><pre><code>POST /index/_analyze

{
  &quot;tokenizer&quot;: &quot;tokenfilter_ngram&quot;,
  &quot;text&quot;: &quot;foo bar&quot;
}
</code></pre><p>–ò —É–≤–∏–¥–∏–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø–æ–¥—Å—Ç—Ä–æ–∫–∏ –¥–ª–∏–Ω—ã 2 –∏ 3 (–ø–æ—Å–∫–æ–ª—å–∫—É –ø–∞—Ä–∞–º–µ—Ç—Ä <code>min_gram</code> —Ä–∞–≤–µ–Ω 2). –ß–∞—Å—Ç—å –æ—Ç–≤–µ—Ç–∞ Elastic —Å–∫—Ä—ã—Ç–∞ –¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏</p><pre><code>{
  &quot;tokens&quot;: [
    {
      &quot;token&quot;: &quot;fo&quot;
    },
    {
      &quot;token&quot;: &quot;foo&quot;
    },
    {
      &quot;token&quot;: &quot;oo&quot;
    },
    {
      &quot;token&quot;: &quot;ba&quot;
    },
    {
      &quot;token&quot;: &quot;bar&quot;
    },
    {
      &quot;token&quot;: &quot;ar&quot;
    },
  ]
}
</code></pre><p>–î—Ä—É–≥–æ–π –ø—Ä–∏–º–µ—Ä –∏–∑ –ë–∏–ª–ª–∏–Ω–≥–∞ ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏—â—É—Ç –∫–ª–∏–µ–Ω—Ç–∞ –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞. –†–æ—Å—Å–∏–π—Å–∫–∏–µ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å <code>+7</code> –∏–ª–∏ <code>8</code>, –ø—Ä–∏ —ç—Ç–æ–º –Ω–µ –≤–∞–∂–Ω–æ, –∫–∞–∫ —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–µ–ª–µ—Ñ–æ–Ω –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö ‚Äî —Ö–æ—á–µ—Ç—Å—è –µ–≥–æ –Ω–∞–π—Ç–∏ –∏ —Å <code>+7</code>, –∏ —Å <code>8</code>.</p><p>–°–¥–µ–ª–∞–µ–º –∑–∞–º–µ–Ω—É –ø—Ä–∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ —Å —Ä–µ–≥—É–ª—è—Ä–Ω—ã–º–∏ –≤—ã—Ä–∞–∂–µ–Ω–∏—è–º–∏ —Å –ø–æ–º–æ—â—å—é <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-pattern_replace-tokenfilter.html">Pattern Replace Token Filter</a> –∏ <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-pattern-capture-tokenfilter.html">Pattern Capture Token Filter</a>.</p><p>–î–ª—è —ç—Ç–æ–≥–æ –≤–æ–∑—å–º–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω (–Ω–æ–º–µ—Ä –∏–∑ 11 —Ü–∏—Ñ—Ä, –Ω–∞—á–∏–Ω–∞—é—â–∏–π—Å—è —Å 7 –∏–ª–∏ 8), –∑–∞–º–µ–Ω–∏–º –µ–≥–æ –Ω–∞ –Ω–æ–º–µ—Ä, –Ω–∞—á–∏–Ω–∞—é—â–∏–π—Å—è —Å <code>7</code>, —Å <code>8</code>, –∏ –±–µ–∑ –≤–µ–¥—É—â–µ–≥–æ –∑–Ω–∞–∫–∞.</p><p>–ü–ª—é—Å–∏–∫ –Ω–µ —Ñ–∏–≥—É—Ä–∏—Ä—É–µ—Ç –≤ —Ä–µ–≥—É–ª—è—Ä–∫–∞—Ö, –ø–æ—Ç–æ–º—É —á—Ç–æ –æ—Ç–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–∞–∫ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å —Å–ª–æ–≤.</p><pre><code>{
  &quot;analysis&quot;: {
    &quot;filter&quot;: {
      &quot;phone_multiplier&quot;: {
        &quot;pattern&quot;: &quot;(?&lt;!\\\\d)[7|8](\\\\d{10})(?!\\\\d)&quot;,
        &quot;type&quot;: &quot;pattern_replace&quot;,
        &quot;replacement&quot;: &quot;7$1 8$1 $1&quot;
      },
      &quot;phone_splitter&quot;: {
        &quot;type&quot;: &quot;pattern_capture&quot;,
        &quot;preserve_original&quot;: &quot;false&quot;,
        &quot;patterns&quot;: [
          &quot;(7(?&lt;number&gt;\\\\d{10}))\\\\s(8\\\\k&lt;number&gt;)\\\\s(\\\\k&lt;number&gt;)&quot;
        ]
      }
    }
  }
}
</code></pre><p>–ö–∞–∫ –≥–æ–≤–æ—Ä–∏—Ç—Å—è –≤ –æ–¥–Ω–æ–π —Å—Ç–∞—Ä–æ–π —à—É—Ç–∫–µ:</p><q>–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º–∞ –∏ –≤—ã —Ä–µ—à–∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è, —É –≤–∞—Å —É–∂–µ –¥–≤–µ –ø—Ä–æ–±–ª–µ–º—ã.</q><p>–ï—â–µ –æ–¥–∏–Ω –ø—Ä–∏–º–µ—Ä, –≥–¥–µ –∞–Ω–∞–ª–∏–∑ —É–ø—Ä–æ—â–∞–µ—Ç –∂–∏–∑–Ω—å ‚Äî –±—É–∫–≤—ã <code>–µ</code> –∏ <code>—ë</code>. –ü–æ–∫–∞ –∑–∞–Ω—É–¥—ã —Å–ø–æ—Ä—è—Ç, –Ω—É–∂–Ω–æ –ª–∏ –≤ –≤–µ–±-—Å–µ—Ä–≤–∏—Å–∞—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å <code>—ë</code>, –º—ã –ø–æ–¥–¥–µ—Ä–∂–∞–ª–∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö <code>—ë</code> –≤ <code>–µ</code>, –∫–∞–∫ –ø—Ä–∏ –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, —Ç–∞–∫ –∏ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–∞—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –ª–µ–≥–∫–æ —Å–¥–µ–ª–∞—Ç—å –≤ –∫–æ–¥–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –Ω–æ –º–æ–∂–Ω–æ –∏ –≤—ã–Ω–µ—Å—Ç–∏ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫—É Elastic:</p><pre><code>{
  &quot;analysis&quot;: {
    &quot;filter:&quot; {
      &quot;char_filter&quot;: {
        &quot;e_mapping&quot;: {
          &quot;type&quot;: &quot;mapping&quot;,
          &quot;mapping&quot;: [&quot;–Å=&gt;–ï&quot;, &quot;—ë=&gt;–µ&quot;]
        }
      }
    }
  }
}
</code></pre><p>–í–∏—à–µ–Ω–∫–∞ –Ω–∞ —Ç–æ—Ä—Ç–µ ‚Äî –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞—Å–∫–ª–∞–¥–∫–∏ –∑–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ù–µ—É–¥–æ–±–Ω–æ, –∫–æ–≥–¥–∞ –Ω–∞—á–∏–Ω–∞–µ—à—å –Ω–∞–±–∏—Ä–∞—Ç—å —Ä—É—Å—Å–∫–∏–π —Ç–µ–∫—Å—Ç –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º, –∑–∞–±—ã–≤ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ä–∞—Å–∫–ª–∞–¥–∫—É. –ë–∏–ª–ª–∏–Ω–≥ –ø—Ä–æ–±—É–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ä–∞—Å–∫–ª–∞–¥–∫—É –∑–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –†–∞–±–æ—Ç–∞–µ—Ç —ç—Ç–æ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Ç–∞–∫ ‚Äî –µ—Å–ª–∏ –≤ –∑–∞–ø—Ä–æ—Å–µ –Ω–µ—Ç —Ä—É—Å—Å–∫–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤, –∏ –ø–æ–¥ —É—Å–ª–æ–≤–∏—è –ø–æ–∏—Å–∫–∞ –Ω–µ –ø–æ–¥–æ—à–µ–ª –Ω–∏ –æ–¥–∏–Ω –¥–æ–∫—É–º–µ–Ω—Ç, —Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–æ–±—É–µ—Ç –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–ø—Ä–æ—Å, –Ω–æ –∏–∑–º–µ–Ω–∏–≤ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ —Å–∏–º–≤–æ–ª—ã –Ω–∞ —Ä—É—Å—Å–∫–∏–µ ‚Äî –≤ –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–∏, —á—Ç–æ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è qwerty-—Ä–∞—Å–∫–ª–∞–¥–∫–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã. –†–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —á–∞—Å—ã.</p><img src="img/a6aba9ac-dbbf-40c4-b95c-4c2f63655a84.png" style="display: block; margin-left: auto; margin-right: auto"></img><div></div><h2>–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å</h2><p>–í –≤—ã–¥–∞—á–µ –ø–æ–∏—Å–∫–∞ –µ—Å—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ ‚Äî –≤—Å–µ –æ–Ω–∏ –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ –æ–¥–Ω–æ–º —Å–ø–∏—Å–∫–µ. –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–∏–ø—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤–∞–∂–Ω–µ–µ –¥—Ä—É–≥–∏—Ö, –∏—Ö –Ω—É–∂–Ω–æ –ø–æ–¥–Ω–∏–º–∞—Ç—å –≤ –≤—ã–¥–∞—á–µ. –ú—ã —á—É—Ç—å-—á—É—Ç—å –ø–æ–¥–∫—Ä—É—Ç–∏–ª–∏ –ø–æ–∏—Å–∫, –∏—Å—Ö–æ–¥—è –∏–∑ —Ç–æ–≥–æ, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏—â—É—Ç —á–∞—â–µ:</p><ul><li>–ö–ª–∏–µ–Ω—Ç—ã –≤–∞–∂–Ω–µ–µ, —á–µ–º –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω–æ–µ (–∑–∞–∫–∞–∑—ã, –¥–æ–∫—É–º–µ–Ω—Ç—ã, –∫–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø—Ä–æ—á–µ–µ);</li><li>–ó–∞–∫–∞–∑—ã –Ω–µ —Ç–∞–∫ –≤–∞–∂–Ω—ã, –∫–∞–∫ –∫–ª–∏–µ–Ω—Ç—ã, –Ω–æ –≤–∞–∂–Ω–µ–µ —á–µ–º –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω–æ–µ;</li><li>–¢–æ—á–Ω–æ–µ –≤—Ö–æ–∂–¥–µ–Ω–∏–µ –Ω–∞–º–Ω–æ–≥–æ –ª—É—á—à–µ, —á–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –ø–æ–¥—Å—Ç—Ä–æ–∫.</li></ul><p>–ú—ã –Ω–∞—Å—Ç—Ä–æ–∏–ª–∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å –ø–æ–º–æ—â—å—é —Ç—é–Ω–∏–Ω–≥–∞ –∑–∞–ø—Ä–æ—Å–æ–≤. –í <a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/practical-scoring-function.html">—Ñ–æ—Ä–º—É–ª–µ —Ä–∞—Å—á–µ—Ç–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏</a> –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ —Å–ª–æ–≤–∞ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è <a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/query-time-boosting.html">boost</a> ‚Äî –º–Ω–æ–∂–∏—Ç–µ–ª—å, –∫–æ—Ç–æ—Ä—ã–π —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –≤–µ—Å –¥–æ–∫—É–º–µ–Ω—Ç–∞, –µ—Å–ª–∏ —Å–ª–æ–≤–æ –≤—Å—Ç—Ä–µ—Ç–∏–ª–æ—Å—å –≤ –Ω–µ–º.</p><pre><code>{
  &quot;query&quot;: {
    &quot;bool&quot;: {
      &quot;minimum_should_match&quot;: 0,
      &quot;should&quot;: [
        {
          &quot;term&quot;: {
            &quot;entityType&quot;: {
              &quot;value&quot;: &quot;client&quot;,
              &quot;boost&quot;: 100
            }
          }
        },
        {
          &quot;term&quot;: {
            &quot;entityType&quot;: {
              &quot;value&quot;: &quot;bills&quot;,
              &quot;boost&quot;: 50
            }
          }
        },
        {
          &quot;match&quot;: {
            &quot;textExact&quot;: {
              &quot;value&quot;: &quot;–∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è&quot;,
              &quot;operator&quot;: &quot;and&quot;,
              &quot;boost&quot;: 200
            }
          }
        }
      ]
    }
  }
}
</code></pre><p>–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –º—ã –∑–∞–≤–µ—Ä–Ω—É–ª–∏ –≤ <code>should</code> —Å <code>minumum_should_match</code>, —Ä–∞–≤–Ω—ã–º 0. –ù–∏ –æ–¥–∏–Ω –∏–∑ —ç—Ç–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ç–æ, –ø–æ–¥–æ–π–¥–µ—Ç –ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç –ø–æ–¥ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –ø–æ–∏—Å–∫–∞, –Ω–æ –∫–∞–∂–¥—ã–π –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞. –ü–æ—Å–ª–µ–¥–Ω–∏–π <code>match</code> –∏—â–µ—Ç –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ø–æ–ª–µ <code>textExact</code> ‚Äî —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –ø–æ–ª–µ, –∫–æ—Ç–æ—Ä–æ–µ –ø–æ–¥–≤–µ—Ä–≥–∞–µ—Ç—Å—è –º–∏–Ω–∏–º—É–º—É –∞–Ω–∞–ª–∏–∑–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–µ —Ä–∞–∑–±–∏–≤–∞–µ—Ç—Å—è –Ω–∞ ngram&#x27;—ã. –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø–æ—á—Ç–∏ –Ω–µ —Ç—Ä–æ–Ω—É—Ç–æ–º –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–æ–º —Ç–µ–∫—Å—Ç–µ ‚Äî —Å–∫–æ—Ä–µ–π –≤—Å–µ–≥–æ, —ç—Ç–æ –∏–º–µ–Ω–Ω–æ —Ç–æ, —á—Ç–æ –Ω—É–∂–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.</p><p>–° –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π <code>boost</code> –ø–æ —Ç–∏–ø—É –¥–æ–∫—É–º–µ–Ω—Ç–∞ –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º–∞. –†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å –≤ Elastic –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–µ–¥–∫–æ—Å—Ç–∏ —Å–ª–æ–≤–∞ –∏ –¥–ª–∏–Ω—ã –¥–æ–∫—É–º–µ–Ω—Ç–∞. –ù–∞–ø—Ä–∏–º–µ—Ä, –≤ –ë–∏–ª–ª–∏–Ω–≥–µ –Ω–∞ –ø–æ—Ä—è–¥–æ–∫ –±–æ–ª—å—à–µ –∫–ª–∏–µ–Ω—Ç–æ–≤, —á–µ–º –∑–∞—è–≤–æ–∫ –Ω–∞ —Ä–∞–±–æ—Ç—É —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏ ‚Äî –ø–æ—ç—Ç–æ–º—É Elastic —Å–∞–º –ø–æ–¥–Ω–∏–º–∞–µ—Ç –≤–µ—Å –∑–∞—è–≤–æ–∫, –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –º–Ω–æ–∂–∏—Ç–µ–ª—å <code>boost</code>. –ü–ª—é—Å –∫–æ—Ä–æ—Ç–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –±–æ–ª–µ–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã. –í—Å–µ —ç—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ —Ç–æ–º—É, —á—Ç–æ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ—á—Ç–∏ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏, –ø–æ–∫–∞ –Ω–µ –≤–≤–µ–¥–µ—à—å –≤ –ø–æ–∏—Å–∫ —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ.</p><p>–ú–æ–∂–Ω–æ —Ä–µ—à–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É, –¥–∞–ª—å—à–µ –ø–æ–¥—Ç—é–Ω–∏–≤–∞—è <code>boost</code>. –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–µ–ª–∞—Ç—å UI, —á—Ç–æ–±—ã —Ä–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –ø–æ —Ç–∏–ø—É. –ú—ã —Ä–µ—à–∏–ª–∏ –ø–æ–π—Ç–∏ —Ç—Ä–µ—Ç—å–∏–º –ø—É—Ç–µ–º ‚Äî –∑–∞–∏–≥–Ω–æ—Ä–∏–ª–∏ —Ñ–æ—Ä–º—É–ª—É —Ä–∞—Å—á–µ—Ç–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –ø–æ —Ç–∏–ø—É –¥–æ–∫—É–º–µ–Ω—Ç–∞ —Å –ø–æ–º–æ—â—å—é –∑–∞–ø—Ä–æ—Å–∞ <a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/ignoring-tfidf.html">constant_score</a>. –≠—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å –¥–∞–µ—Ç —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤–µ—Å –≤ —Ñ–æ—Ä–º—É–ª–µ –ø–æ–¥—Å—á–µ—Ç–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏, –µ—Å–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è–µ—Ç –∑–∞–ø—Ä–æ—Å—É. –í –∏—Ç–æ–≥–µ, –ø–æ–∏—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞–º–Ω–æ–≥–æ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–µ–µ, —É–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç—ã –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–æ.</p><p>–ü–æ—Å–ª–µ–¥–Ω–∏–π –∏–Ω–≥—Ä–∏–¥–∏–µ–Ω—Ç ‚Äî <code>should</code> –∑–∞–ø—Ä–æ—Å –ø–æ —Ç–µ–∫—Å—Ç—É —Å –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ–º —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ &quot;–ø–æ-—á–µ—Å—Ç–Ω–æ–º—É&quot;. –û–Ω –Ω—É–∂–µ–Ω, —á—Ç–æ–±—ã —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã –æ–¥–∏–Ω–∞–∫–æ–≤–æ–≥–æ —Ç–∏–ø–∞ (Elastic —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å —ç—Ç–∏–º –ø—Ä–µ–∫—Ä–∞—Å–Ω–æ). –í–µ—Å–∞ –ø–æ–¥–æ–±—Ä–∞–Ω—ã —Ç–∞–∫, —á—Ç–æ <code>constant_score</code> –∑–∞–ø—Ä–æ—Å—ã –∏–º–µ—é—Ç –Ω–∞ –ø–æ—Ä—è–¥–æ–∫ –±–æ–ª—å—à–µ –≤–µ—Å, —á—Ç–æ–±—ã –Ω–µ –Ω–∞—Ä—É—à–∞—Ç—å –ø–æ—Ä—è–¥–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø–æ –∏—Ö —Ç–∏–ø—É.</p><pre><code>{
  &quot;query&quot;: {
    &quot;bool&quot;: {
      &quot;minimum_should_match&quot;: 0,
      &quot;should&quot;: [
        {
          &quot;constant_score&quot;: {
            &quot;query&quot;: {
              &quot;term&quot;: {
                &quot;entityType&quot;: {
                  &quot;value&quot;: &quot;client&quot;,
                  &quot;boost&quot;: 200
                }
              }
            }
          }
        },
        {
          &quot;constant_score&quot;: {
            &quot;query&quot;: {
              &quot;term&quot;: {
                &quot;entityType&quot;: {
                  &quot;value&quot;: &quot;bills&quot;,
                  &quot;boost&quot;: 100
                }
              }
            }
          }
        },
        {
          &quot;constant_score&quot;: {
            &quot;query&quot;: {
              &quot;match&quot;: {
                &quot;textExact&quot;: {
                  &quot;value&quot;: &quot;—Ç–µ–∫—Å—Ç –∑–∞–ø—Ä–æ—Å–∞&quot;,
                  &quot;boost&quot;: 120,
                  &quot;operator&quot;: &quot;and&quot;
                }
              }
            }
          }
        },
        {
          &quot;match&quot;: {
            &quot;text&quot;: {
              &quot;value&quot;: &quot;—Ç–µ–∫—Å—Ç –∑–∞–ø—Ä–æ—Å–∞&quot;,
            }
          }
        }
      ]
    }
  }
}
</code></pre><h2>TL;DR</h2><p>–ò—Ç–æ–≥–æ–≤—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—é ElasticSearch –æ—Ç —à–µ—Ñ–∞:</p><ul><li>–ò–Ω–¥–µ–∫—Å–∏—Ä—É–π –¥–∞–Ω–Ω—ã–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ;</li><li>–ê–≤—Ç–æ—Ä–∏–∑—É–π –∑–∞–ø—Ä–æ—Å—ã –∫ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º –¥–∞–Ω–Ω—ã–º —Å –ø–æ–º–æ—â—å—é Access Control List;</li><li>–ò—Å–ø–æ–ª—å–∑—É–π —Å—Ä–µ–¥—Å—Ç–≤–∞ –∞–Ω–∞–ª–∏–∑–∞, —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å –ø–æ–∏—Å–∫ —É–¥–æ–±–Ω—ã–º –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è;</li><li>–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–π <code>boost</code>, —á—Ç–æ–±—ã –Ω–∞—Ö–æ–¥–∏—Ç—å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã.</li></ul></div></body></html>